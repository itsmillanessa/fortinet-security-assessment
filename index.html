<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fortinet Security Fabric - Roadmap de Madurez Visual</title>
    <meta name="description" content="Herramienta ejecutiva para evaluaci√≥n de madurez en ciberseguridad con roadmap visual interactivo">
    
    <style>
        :root {
            --fortinet-red: #E31E24;
            --fortinet-dark-red: #B71C1C;
            --success-green: #10b981;
            --warning-orange: #f59e0b;
            --info-blue: #3b82f6;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-600: #6b7280;
            --gray-900: #1f2937;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-200) 50%, var(--gray-100) 100%);
            min-height: 100vh;
            line-height: 1.6;
            color: var(--gray-900);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .logo-box {
            background: linear-gradient(135deg, var(--fortinet-red) 0%, var(--fortinet-dark-red) 100%);
            border-radius: 15px;
            padding: 15px 25px;
            margin-right: 20px;
            box-shadow: 0 8px 25px rgba(227, 30, 36, 0.3);
            transform: perspective(500px) rotateY(-5deg);
            transition: transform 0.3s ease;
        }

        .logo-icon {
            font-size: 36px;
            color: white;
            font-weight: bold;
        }

        .main-title {
            font-size: 42px;
            font-weight: 900;
            color: var(--gray-900);
            margin: 0;
            line-height: 1.2;
            background: linear-gradient(135deg, var(--fortinet-red), var(--fortinet-dark-red));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 20px;
            color: var(--fortinet-red);
            font-weight: 700;
            margin-top: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .description {
            font-size: 18px;
            color: var(--gray-600);
            max-width: 700px;
            margin: 15px auto 0;
            font-weight: 500;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card-title {
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 30px;
            text-align: center;
            background: linear-gradient(135deg, var(--fortinet-red), var(--fortinet-dark-red));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .btn {
            padding: 18px 40px;
            border-radius: 12px;
            border: none;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 10px 10px 0;
            transition: all 0.3s ease;
            display: inline-block;
            text-decoration: none;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--fortinet-red) 0%, var(--fortinet-dark-red) 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(227, 30, 36, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(55, 65, 81, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-green) 0%, #047857 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info-blue) 0%, #1d4ed8 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-orange) 0%, #d97706 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }

        .hidden {
            display: none;
        }

        .grid {
            display: grid;
            gap: 25px;
            margin-bottom: 30px;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }

        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .industry-card {
            padding: 25px;
            border: 3px solid var(--gray-200);
            border-radius: 20px;
            cursor: pointer;
            background: white;
            transition: all 0.4s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .industry-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            border-color: var(--fortinet-red);
        }

        .industry-card.selected {
            border: 3px solid var(--fortinet-red);
            background: linear-gradient(135deg, #fef2f2, #ffffff);
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(227, 30, 36, 0.3);
        }

        .industry-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .industry-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 12px;
        }

        .industry-frameworks {
            font-size: 13px;
            color: var(--gray-600);
            font-weight: 500;
        }

        .tech-card {
            padding: 20px;
            border: 3px solid var(--gray-200);
            border-radius: 15px;
            cursor: pointer;
            background: white;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .tech-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 25px rgba(0,0,0,0.1);
        }

        .tech-card.implemented {
            border: 3px solid var(--success-green);
            background: linear-gradient(135deg, #f0fdf4, #ffffff);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.2);
        }

        .tech-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .tech-info {
            display: flex;
            align-items: center;
        }

        .tech-icon {
            font-size: 24px;
            margin-right: 10px;
        }

        .tech-name {
            font-weight: bold;
            font-size: 16px;
        }

        .tech-status {
            color: var(--success-green);
            font-size: 20px;
        }

        .tech-desc {
            font-size: 13px;
            color: var(--gray-600);
            margin: 8px 0;
        }

        .tech-metadata {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--gray-500);
            margin-top: 10px;
        }

        .maturity-level {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--info-blue);
            color: white;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .metric-card {
            text-align: center;
            padding: 25px 15px;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .metric-value {
            font-size: 48px;
            font-weight: 900;
            margin-bottom: 8px;
            position: relative;
            z-index: 2;
            line-height: 1;
        }

        .metric-label {
            font-size: 13px;
            color: var(--gray-600);
            font-weight: 600;
            position: relative;
            z-index: 2;
            line-height: 1.3;
        }

        .roadmap-container {
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-200) 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: inset 0 4px 8px rgba(0,0,0,0.1);
        }

        .roadmap-canvas {
            width: 100%;
            height: 600px;
            border-radius: 15px;
            border: 3px solid var(--gray-200);
            cursor: grab;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            background: white;
        }

        .roadmap-canvas:active {
            cursor: grabbing;
        }

        .canvas-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 10px 18px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            background: white;
            color: var(--gray-600);
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            border-color: var(--fortinet-red);
            color: var(--fortinet-red);
            transform: translateY(-2px);
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid var(--gray-200);
            border-radius: 20px;
            background: white;
            color: var(--gray-600);
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            border-color: var(--fortinet-red);
            color: var(--fortinet-red);
        }

        .filter-btn.active {
            border: 2px solid var(--fortinet-red);
            background: var(--fortinet-red);
            color: white;
        }

        /* Nuevos estilos para vista completa */
        .view-toggle {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .roadmap-canvas.full-view {
            height: 800px; /* M√°s altura para mostrar todas las tecnolog√≠as */
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .main-title {
                font-size: 28px;
            }

            .btn {
                width: 100%;
                margin: 8px 0;
            }

            .card {
                padding: 25px;
            }

            .roadmap-canvas {
                height: 400px;
            }

            .roadmap-canvas.full-view {
                height: 500px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo-container">
                <div class="logo-box">
                    <span class="logo-icon">üõ°Ô∏è</span>
                </div>
                <div>
                    <h1 class="main-title">Fortinet Security Fabric</h1>
                    <div class="subtitle">Roadmap de Madurez Visual</div>
                </div>
            </div>
            <p class="description">
                Eval√∫e su madurez actual en ciberseguridad y visualice su camino hacia la excelencia con el portafolio completo de Fortinet
            </p>
        </div>

        <!-- Homepage -->
        <div id="homepage" class="card">
            <div style="text-align: center; margin: 40px 0;">
                <button class="btn btn-primary" onclick="startAssessment()">
                    üöÄ Iniciar Assessment de Madurez
                </button>
                <button class="btn btn-info" onclick="loadDemo()">
                    üëÄ Ver Demo Interactivo
                </button>
            </div>
        </div>

        <!-- Step 1: Industry Selection -->
        <div id="step1" class="card hidden">
            <h2 class="card-title">üè¢ Selecciona tu Industria</h2>
            
            <div class="grid grid-3" id="industries-grid">
                <!-- Se llena din√°micamente -->
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" id="continue-btn" disabled onclick="continueToAssessment()">
                    Continuar al Assessment ‚Üí
                </button>
            </div>
        </div>

        <!-- Step 1.5: Company Size Selection -->
        <div id="step1_5" class="card hidden">
            <h2 class="card-title">üè¢ Tama√±o de tu Organizaci√≥n</h2>
            <p style="text-align: center; margin-bottom: 30px; color: var(--gray-600);">
                Esta informaci√≥n nos ayuda a <strong>personalizar el an√°lisis de madurez</strong> y las recomendaciones seg√∫n el contexto de tu empresa
            </p>
            
            <div class="grid grid-2" id="company-size-grid">
                <!-- Se llena din√°micamente -->
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-secondary" onclick="goToStep(1)">
                    ‚Üê Anterior
                </button>
                <button class="btn btn-primary" id="continue-size-btn" disabled onclick="continueToTechAssessment()">
                    Continuar al Assessment ‚Üí
                </button>
            </div>
        </div>

        <!-- Step 2: Technology Assessment -->
        <div id="step2" class="card hidden">
            <h2 class="card-title">üîç Assessment de Tecnolog√≠as Fortinet</h2>
            <p style="text-align: center; margin-bottom: 30px; color: var(--gray-600);">
                Selecciona las tecnolog√≠as de Fortinet que tienes <strong>actualmente implementadas</strong> en tu organizaci√≥n
            </p>
            
            <!-- Category Filters -->
            <div class="filter-buttons" id="category-filters">
                <!-- Se llena din√°micamente -->
            </div>
            
            <div class="grid grid-4" id="technologies-grid">
                <!-- Se llena din√°micamente -->
            </div>

            <div style="display: flex; justify-content: space-between; flex-wrap: wrap; gap: 15px; margin-top: 30px;">
                <button class="btn btn-secondary" onclick="goToStep(1.5)">
                    ‚Üê Anterior
                </button>
                <button class="btn btn-success" onclick="generateMaturityRoadmap()">
                    üìä Generar Roadmap de Madurez
                </button>
            </div>
        </div>

        <!-- Step 3: Results -->
        <div id="step3" class="hidden">
            <!-- Maturity Overview -->
            <div class="card">
                <h2 class="card-title">üéØ An√°lisis de Madurez Actual</h2>
                
                <div class="metrics-grid" id="metrics-grid">
                    <!-- Se llena din√°micamente -->
                </div>
            </div>

            <!-- Visual Maturity Roadmap -->
            <div class="card">
                <h2 class="card-title">üó∫Ô∏è Roadmap Visual de Madurez en Ciberseguridad</h2>
                
                <!-- Toggle de vista -->
                <div class="view-toggle">
                    <button class="btn btn-info" id="view-current-btn" onclick="toggleRoadmapView(false)">
                        üìä Ver Mi Progreso Actual
                    </button>
                    <button class="btn btn-warning" id="view-complete-btn" onclick="toggleRoadmapView(true)">
                        üó∫Ô∏è Ver Todo el Roadmap Completo
                    </button>
                </div>
                
                <div class="canvas-controls">
                    <button class="control-btn" onclick="zoomCanvas(1.2)">üîç+ Zoom In</button>
                    <button class="control-btn" onclick="zoomCanvas(0.8)">üîç- Zoom Out</button>
                    <button class="control-btn" onclick="resetCanvas()">üîÑ Reset View</button>
                    <button class="control-btn" onclick="downloadRoadmap()">üì∏ Descargar</button>
                </div>
                
                <div class="roadmap-container">
                    <canvas id="roadmap-canvas" class="roadmap-canvas"></canvas>
                </div>
            </div>

            <!-- Recommended Technologies -->
            <div class="card">
                <h2 class="card-title">üéØ Pr√≥ximos Pasos Recomendados</h2>
                <div id="recommended-techs">
                    <!-- Se llena din√°micamente -->
                </div>
            </div>

            <!-- Action Buttons -->
            <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-top: 40px;">
                <button class="btn btn-secondary" onclick="resetAssessment()">
                    üîÑ Nuevo Assessment
                </button>
                <button class="btn btn-primary" onclick="downloadRoadmap()">
                    üñºÔ∏è Descargar Roadmap
                </button>
                <button class="btn btn-info" onclick="generateReport()">
                    üìÑ Reporte Ejecutivo
                </button>
                <button class="btn btn-success" onclick="scheduleDemo()">
                    üìÖ Agendar Demo
                </button>
            </div>
        </div>
    </div>

    <script>
        console.log('üöÄ Iniciando Fortinet Maturity Roadmap...');

        // ============ DATA STRUCTURES ============
        const industries = {
            financial: { 
                name: 'Servicios Financieros', 
                icon: 'üè¶', 
                frameworks: ['SOX', 'PCI-DSS', 'NIST', 'ISO27001'],
                riskProfile: 'Cr√≠tico',
                avgBreachCost: 5850000,
                complianceWeight: 0.9
            },
            government: { 
                name: 'Gobierno y Sector P√∫blico', 
                icon: 'üèõÔ∏è', 
                frameworks: ['NIST', 'FedRAMP', 'FISMA', 'CISA'],
                riskProfile: 'Muy Alto',
                avgBreachCost: 4950000,
                complianceWeight: 0.95
            },
            healthcare: { 
                name: 'Salud y Farmac√©utica', 
                icon: 'üè•', 
                frameworks: ['HIPAA', 'HITECH', 'FDA', 'ISO27001'],
                riskProfile: 'Cr√≠tico',
                avgBreachCost: 7800000,
                complianceWeight: 0.9
            },
            retail: { 
                name: 'Retail y E-commerce', 
                icon: 'üõí', 
                frameworks: ['PCI-DSS', 'GDPR', 'ISO27001', 'SOC2'],
                riskProfile: 'Alto',
                avgBreachCost: 3200000,
                complianceWeight: 0.8
            },
            manufacturing: { 
                name: 'Manufactura e Industrial', 
                icon: 'üè≠', 
                frameworks: ['IEC62443', 'NIST', 'ISO27001', 'NERC'],
                riskProfile: 'Alto',
                avgBreachCost: 4200000,
                complianceWeight: 0.85
            },
            technology: {
                name: 'Tecnolog√≠a y Software',
                icon: 'üíª',
                frameworks: ['SOC2', 'ISO27001', 'NIST', 'Cloud Security'],
                riskProfile: 'Alto',
                avgBreachCost: 4100000,
                complianceWeight: 0.8
            },
            energy: {
                name: 'Energ√≠a y Utilities',
                icon: '‚ö°',
                frameworks: ['NERC CIP', 'IEC62443', 'NIST', 'ISO27001'],
                riskProfile: 'Cr√≠tico',
                avgBreachCost: 6500000,
                complianceWeight: 0.95
            },
            education: {
                name: 'Educaci√≥n',
                icon: 'üéì',
                frameworks: ['FERPA', 'NIST', 'ISO27001'],
                riskProfile: 'Medio',
                avgBreachCost: 2800000,
                complianceWeight: 0.7
            }
        };

        const companySizes = {
            startup: {
                name: 'Startup / Peque√±a Empresa',
                icon: 'üöÄ',
                employees: '1-50 empleados',
                budget: 'Hasta $50K anuales',
                maturityModifier: 0.7,
                budgetRange: [5000, 50000],
                expectedLevel: 1.5,
                description: 'Enfoque en fundamentos de seguridad y crecimiento escalable',
                priorities: ['Protecci√≥n b√°sica', 'Costo-efectividad', 'F√°cil gesti√≥n'],
                challenges: ['Presupuesto limitado', 'Recursos t√©cnicos', 'Cumplimiento b√°sico']
            },
            small: {
                name: 'Empresa Peque√±a',
                icon: 'üè™',
                employees: '51-200 empleados',
                budget: '$50K - $150K anuales',
                maturityModifier: 0.85,
                budgetRange: [50000, 150000],
                expectedLevel: 2.0,
                description: 'Balance entre crecimiento y seguridad estructurada',
                priorities: ['Escalabilidad', 'Cumplimiento', 'Protecci√≥n de datos'],
                challenges: ['Complejidad creciente', 'Compliance', 'Gesti√≥n centralizada']
            },
            medium: {
                name: 'Empresa Mediana',
                icon: 'üè¢',
                employees: '201-1000 empleados',
                budget: '$150K - $500K anuales',
                maturityModifier: 1.0,
                budgetRange: [150000, 500000],
                expectedLevel: 2.8,
                description: 'Estrategia de seguridad madura con m√∫ltiples ubicaciones',
                priorities: ['Visibilidad completa', 'Automatizaci√≥n', 'Integraci√≥n'],
                challenges: ['M√∫ltiples ubicaciones', 'Compliance avanzado', 'Threat detection']
            },
            large: {
                name: 'Empresa Grande',
                icon: 'üèõÔ∏è',
                employees: '1001-5000 empleados',
                budget: '$500K - $2M anuales',
                maturityModifier: 1.15,
                budgetRange: [500000, 2000000],
                expectedLevel: 3.5,
                description: 'Seguridad empresarial con operaciones globales',
                priorities: ['Zero Trust', 'SOC avanzado', 'Threat intelligence'],
                challenges: ['Complejidad global', 'Advanced threats', 'M√∫ltiples clouds']
            },
            enterprise: {
                name: 'Gran Empresa / Enterprise',
                icon: 'üåê',
                employees: '5000+ empleados',
                budget: '$2M+ anuales',
                maturityModifier: 1.3,
                budgetRange: [2000000, 10000000],
                expectedLevel: 4.2,
                description: 'Liderazgo en ciberseguridad con innovaci√≥n continua',
                priorities: ['AI/ML Security', 'Innovaci√≥n', 'Benchmark industria'],
                challenges: ['Amenazas sofisticadas', 'Regulatory complex', 'Digital transformation']
            }
        };

        // Portafolio completo de Fortinet con posiciones fijas para evitar "baile"
        const technologies = {
            // NIVEL 1: INICIAL - Fundamentos de Seguridad
            'FortiGate NGFW': { 
                icon: 'üî•', 
                maturityLevel: 1, 
                score: 1.0, 
                desc: 'Next-Generation Firewall - Protecci√≥n perimetral fundamental con inspecci√≥n profunda', 
                category: 'Network Security',
                cost: 25000,
                annualSavings: 120000,
                implementationTime: '4-6 semanas',
                riskReduction: 30,
                position: { x: 0.1, y: 0.8, side: 'below' }
            },
            'FortiClient EMS': { 
                icon: 'üíª', 
                maturityLevel: 1, 
                score: 0.8, 
                desc: 'Endpoint Management Suite - Gesti√≥n b√°sica y visibilidad de endpoints', 
                category: 'Endpoint Security',
                cost: 15000,
                annualSavings: 75000,
                implementationTime: '2-3 semanas',
                riskReduction: 20,
                position: { x: 0.05, y: 0.85, side: 'above' }
            },
            'FortiMail': { 
                icon: 'üìß', 
                maturityLevel: 1, 
                score: 1.0, 
                desc: 'Secure Email Gateway - Protecci√≥n b√°sica contra phishing y malware por email', 
                category: 'Email & Web Security',
                cost: 18000,
                annualSavings: 95000,
                implementationTime: '2-4 semanas',
                riskReduction: 25,
                position: { x: 0.15, y: 0.75, side: 'above' }
            },
            'FortiAuthenticator': { 
                icon: 'üîê', 
                maturityLevel: 1, 
                score: 0.8, 
                desc: 'Multi-Factor Authentication - Autenticaci√≥n b√°sica de dos factores', 
                category: 'Identity & Access',
                cost: 12000,
                annualSavings: 65000,
                implementationTime: '1-2 semanas',
                riskReduction: 25,
                position: { x: 0.08, y: 0.82, side: 'below' }
            },
            'FortiSwitch': { 
                icon: 'üîå', 
                maturityLevel: 1, 
                score: 0.6, 
                desc: 'Secure Switching - Infraestructura de red b√°sica con seguridad integrada', 
                category: 'Network Infrastructure',
                cost: 14000,
                annualSavings: 60000,
                implementationTime: '2-3 semanas',
                riskReduction: 15,
                position: { x: 0.12, y: 0.78, side: 'below' }
            },
            'FortiAP': { 
                icon: 'üì∂', 
                maturityLevel: 1, 
                score: 0.6, 
                desc: 'Secure Wireless - Access Points con seguridad b√°sica WiFi', 
                category: 'Network Infrastructure',
                cost: 12000,
                annualSavings: 45000,
                implementationTime: '2-3 semanas',
                riskReduction: 15,
                position: { x: 0.18, y: 0.72, side: 'above' }
            },

            // NIVEL 2: B√ÅSICO - Visibilidad y Gesti√≥n
            'FortiAnalyzer': { 
                icon: 'üìä', 
                maturityLevel: 2, 
                score: 1.2, 
                desc: 'Security Analytics - Logging centralizado y reportes b√°sicos de compliance', 
                category: 'SOC & Analytics',
                cost: 30000,
                annualSavings: 150000,
                implementationTime: '4-6 semanas',
                riskReduction: 25,
                position: { x: 0.25, y: 0.65, side: 'below' }
            },
            'FortiManager': { 
                icon: '‚öôÔ∏è', 
                maturityLevel: 2, 
                score: 1.0, 
                desc: 'Centralized Management - Gesti√≥n de pol√≠ticas unificada b√°sica', 
                category: 'Management',
                cost: 25000,
                annualSavings: 125000,
                implementationTime: '3-5 semanas',
                riskReduction: 20,
                position: { x: 0.22, y: 0.68, side: 'above' }
            },
            'FortiWeb': { 
                icon: 'üåç', 
                maturityLevel: 2, 
                score: 1.3, 
                desc: 'Web Application Firewall - Protecci√≥n b√°sica de aplicaciones web', 
                category: 'Application Security',
                cost: 22000,
                annualSavings: 110000,
                implementationTime: '3-4 semanas',
                riskReduction: 30,
                position: { x: 0.28, y: 0.62, side: 'above' }
            },
            'FortiSandbox': { 
                icon: 'üß™', 
                maturityLevel: 2, 
                score: 1.2, 
                desc: 'Advanced Threat Protection - An√°lisis b√°sico de malware desconocido', 
                category: 'Threat Protection',
                cost: 28000,
                annualSavings: 140000,
                implementationTime: '4-5 semanas',
                riskReduction: 32,
                position: { x: 0.32, y: 0.58, side: 'below' }
            },
            'FortiZTA': { 
                icon: 'üîí', 
                maturityLevel: 2, 
                score: 1.1, 
                desc: 'Zero Trust Access - Incluido con FortiGate + FortiClient EMS. Acceso seguro sin costo adicional', 
                category: 'Zero Trust',
                cost: 0, // Sin costo adicional
                annualSavings: 85000,
                implementationTime: '2-3 semanas',
                riskReduction: 25,
                position: { x: 0.35, y: 0.55, side: 'above' },
                prerequisite: ['FortiGate NGFW', 'FortiClient EMS'],
                fabricBenefit: 'Activaci√≥n autom√°tica con FortiGate + FortiClient EMS existentes'
            },

            // NIVEL 3: INTERMEDIO - Detecci√≥n y Respuesta
            'FortiEDR': { 
                icon: 'üõ°Ô∏è', 
                maturityLevel: 3, 
                score: 1.8, 
                desc: 'Endpoint Detection & Response - Detecci√≥n avanzada y respuesta automatizada en endpoints', 
                category: 'Endpoint Security',
                cost: 45000,
                annualSavings: 225000,
                implementationTime: '6-8 semanas',
                riskReduction: 40,
                position: { x: 0.42, y: 0.48, side: 'above' }
            },
            'FortiXDR': { 
                icon: 'üéØ', 
                maturityLevel: 3, 
                score: 2.2, 
                desc: 'Extended Detection & Response - Correlaci√≥n inteligente multiplataforma', 
                category: 'SOC & Analytics',
                cost: 60000,
                annualSavings: 300000,
                implementationTime: '8-12 semanas',
                riskReduction: 45,
                position: { x: 0.48, y: 0.42, side: 'below' }
            },
            'FortiSIEM': { 
                icon: 'üìà', 
                maturityLevel: 3, 
                score: 2.0, 
                desc: 'Security Information & Event Management - SIEM empresarial con compliance', 
                category: 'SOC & Analytics',
                cost: 50000,
                annualSavings: 250000,
                implementationTime: '10-14 semanas',
                riskReduction: 40,
                position: { x: 0.38, y: 0.52, side: 'below' }
            },
            'FortiSOAR': { 
                icon: 'ü§ñ', 
                maturityLevel: 3, 
                score: 1.8, 
                desc: 'Security Orchestration & Automated Response - Automatizaci√≥n de playbooks', 
                category: 'SOC & Analytics',
                cost: 55000,
                annualSavings: 275000,
                implementationTime: '8-12 semanas',
                riskReduction: 38,
                position: { x: 0.45, y: 0.45, side: 'above' }
            },

            // NIVEL 4: AVANZADO - Integraci√≥n Inteligente
            'FortiDeceptor': { 
                icon: 'üï∏Ô∏è', 
                maturityLevel: 4, 
                score: 1.5, 
                desc: 'Deception Technology - Honeypots inteligentes para threat hunting avanzado', 
                category: 'Threat Protection',
                cost: 40000,
                annualSavings: 180000,
                implementationTime: '6-8 semanas',
                riskReduction: 35,
                position: { x: 0.58, y: 0.32, side: 'below' }
            },
            'FortiCWP': { 
                icon: '‚òÅÔ∏è', 
                maturityLevel: 4, 
                score: 1.6, 
                desc: 'Cloud Workload Protection - Seguridad avanzada para cargas de trabajo cloud', 
                category: 'Cloud Security',
                cost: 35000,
                annualSavings: 175000,
                implementationTime: '4-6 semanas',
                riskReduction: 33,
                position: { x: 0.62, y: 0.28, side: 'above' }
            },
            'FortiInsight': { 
                icon: 'üî¨', 
                maturityLevel: 4, 
                score: 1.4, 
                desc: 'User Entity Behavior Analytics - UEBA con machine learning avanzado', 
                category: 'SOC & Analytics',
                cost: 38000,
                annualSavings: 190000,
                implementationTime: '6-8 semanas',
                riskReduction: 30,
                position: { x: 0.55, y: 0.35, side: 'above' }
            },
            'FortiNAC': { 
                icon: 'üö¶', 
                maturityLevel: 4, 
                score: 1.5, 
                desc: 'Network Access Control - Control avanzado de acceso a la red', 
                category: 'Network Security',
                cost: 42000,
                annualSavings: 185000,
                implementationTime: '6-8 semanas',
                riskReduction: 35,
                position: { x: 0.65, y: 0.25, side: 'below' }
            },

            // NIVEL 5: EXCELENCIA - Zero Trust y AI
            'FortiSASE': { 
                icon: 'üöÄ', 
                maturityLevel: 5, 
                score: 2.8, 
                desc: 'Secure Access Service Edge - Zero Trust completo con IA y cloud-native', 
                category: 'SASE & Zero Trust',
                cost: 100000,
                annualSavings: 500000,
                implementationTime: '16-20 semanas',
                riskReduction: 55,
                position: { x: 0.78, y: 0.15, side: 'above' }
            },
            'FortiAIOps': { 
                icon: 'üß†', 
                maturityLevel: 5, 
                score: 2.5, 
                desc: 'AI Operations - Inteligencia artificial para operaciones de seguridad aut√≥nomas', 
                category: 'AI & ML',
                cost: 85000,
                annualSavings: 425000,
                implementationTime: '12-16 semanas',
                riskReduction: 50,
                position: { x: 0.75, y: 0.18, side: 'below' }
            },
            'Perception Point': { 
                icon: 'üëÅÔ∏è', 
                maturityLevel: 5, 
                score: 2.0, 
                desc: 'Advanced Email Security - IA de pr√≥xima generaci√≥n para email y colaboraci√≥n', 
                category: 'Email Security',
                cost: 65000,
                annualSavings: 325000,
                implementationTime: '8-12 semanas',
                riskReduction: 45,
                position: { x: 0.72, y: 0.21, side: 'above' }
            },
            'FortiRecon': { 
                icon: 'üîç', 
                maturityLevel: 5, 
                score: 1.9, 
                desc: 'Digital Attack Surface Management - Inteligencia de amenazas externa avanzada', 
                category: 'Threat Intelligence',
                cost: 55000,
                annualSavings: 275000,
                implementationTime: '8-10 semanas',
                riskReduction: 42,
                position: { x: 0.82, y: 0.12, side: 'below' }
            }
        };

        console.log(`‚úÖ Cargadas ${Object.keys(technologies).length} tecnolog√≠as de Fortinet con posiciones fijas`);

        // ============ APP STATE ============
        let currentStep = 0;
        let assessmentData = {
            industry: '',
            companySize: '',
            frameworks: [],
            techs: {},
            categoryFilter: 'Todas'
        };
        let results = null;
        let canvasScale = 1;
        let showCompleteRoadmap = false; // Nueva variable para controlar la vista

        // Canvas variables para evitar el "baile"
        let canvasOffsetX = 0;
        let canvasOffsetY = 0;
        let isDragging = false;
        let lastMouseX = 0;
        let lastMouseY = 0;
        let hoveredNode = null;
        let animationFrame = null;

        // ============ NAVIGATION FUNCTIONS ============
        function goToStep(step) {
            console.log(`üîÑ Navegando a step ${step}`);
            
            try {
                const homepage = document.getElementById('homepage');
                const step1 = document.getElementById('step1');
                const step1_5 = document.getElementById('step1_5');
                const step2 = document.getElementById('step2');
                const step3 = document.getElementById('step3');
                
                if (homepage) homepage.classList.add('hidden');
                if (step1) step1.classList.add('hidden');
                if (step1_5) step1_5.classList.add('hidden');
                if (step2) step2.classList.add('hidden');
                if (step3) step3.classList.add('hidden');
                
                currentStep = step;
                
                if (step === 0 && homepage) {
                    homepage.classList.remove('hidden');
                } else if (step === 1 && step1) {
                    step1.classList.remove('hidden');
                } else if (step === 1.5 && step1_5) {
                    step1_5.classList.remove('hidden');
                } else if (step === 2 && step2) {
                    step2.classList.remove('hidden');
                } else if (step === 3 && step3) {
                    step3.classList.remove('hidden');
                } else {
                    console.error(`‚ùå No se pudo navegar a step ${step}`);
                    if (homepage) homepage.classList.remove('hidden');
                }
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
                console.log(`‚úÖ Navegaci√≥n a step ${step} completada`);
                
            } catch (error) {
                console.error(`‚ùå Error en goToStep: ${error.message}`);
                const homepage = document.getElementById('homepage');
                if (homepage) homepage.classList.remove('hidden');
            }
        }

        function startAssessment() {
            console.log('üöÄ Iniciando assessment de madurez...');
            renderIndustries();
            goToStep(1);
        }

        function loadDemo() {
            console.log('üé¨ Cargando demo...');
            
            assessmentData = {
                industry: 'financial',
                companySize: 'large',
                frameworks: industries.financial.frameworks,
                techs: {
                    'FortiGate NGFW': true,
                    'FortiClient EMS': true,
                    'FortiMail': true,
                    'FortiAuthenticator': true,
                    'FortiAnalyzer': true,
                    'FortiManager': true,
                    'FortiEDR': true,
                    'FortiXDR': true,
                    'FortiSIEM': true
                },
                categoryFilter: 'Todas'
            };
            
            console.log('‚úÖ Demo data cargado');
            setTimeout(() => generateMaturityRoadmap(), 500);
        }

        function continueToAssessment() {
            console.log('‚û°Ô∏è Continuando a selecci√≥n de tama√±o...');
            if (!assessmentData.industry) {
                alert('Por favor selecciona una industria primero');
                return;
            }
            renderCompanySizes();
            goToStep(1.5);
        }

        function continueToTechAssessment() {
            console.log('‚û°Ô∏è Continuando al assessment t√©cnico...');
            if (!assessmentData.companySize) {
                alert('Por favor selecciona el tama√±o de tu empresa');
                return;
            }
            renderTechnologies();
            goToStep(2);
        }

        function resetAssessment() {
            console.log('üîÑ Reseteando assessment...');
            assessmentData = { 
                industry: '', 
                companySize: '',
                frameworks: [], 
                techs: {},
                categoryFilter: 'Todas'
            };
            results = null;
            showCompleteRoadmap = false;
            goToStep(0);
        }

        // ============ NUEVA FUNCI√ìN: TOGGLE ROADMAP VIEW ============
        function toggleRoadmapView(showComplete) {
            console.log(`üîÑ Cambiando vista del roadmap: ${showComplete ? 'completa' : 'actual'}`);
            
            showCompleteRoadmap = showComplete;
            
            // Actualizar botones
            const currentBtn = document.getElementById('view-current-btn');
            const completeBtn = document.getElementById('view-complete-btn');
            const canvas = document.getElementById('roadmap-canvas');
            
            if (showComplete) {
                currentBtn.className = 'btn btn-secondary';
                completeBtn.className = 'btn btn-warning';
                canvas.classList.add('full-view');
            } else {
                currentBtn.className = 'btn btn-info';
                completeBtn.className = 'btn btn-secondary';
                canvas.classList.remove('full-view');
            }
            
            // Resetear canvas y redibujar
            resetCanvas();
            setTimeout(() => {
                drawMaturityRoadmap();
            }, 100);
        }

        // ============ INDUSTRY SELECTION ============
        function renderIndustries() {
            console.log('üè¢ Renderizando industrias...');
            const grid = document.getElementById('industries-grid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            Object.entries(industries).forEach(([key, industry]) => {
                const card = document.createElement('div');
                card.className = `industry-card ${assessmentData.industry === key ? 'selected' : ''}`;
                card.onclick = () => selectIndustry(key);
                
                card.innerHTML = `
                    <div class="industry-icon">${industry.icon}</div>
                    <div class="industry-name">${industry.name}</div>
                    <div class="industry-frameworks">
                        <strong>Frameworks:</strong> ${industry.frameworks.join(', ')}<br>
                        <strong>Perfil de Riesgo:</strong> ${industry.riskProfile}
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        function selectIndustry(industryKey) {
            console.log(`üè¢ Seleccionando industria: ${industryKey}`);
            
            try {
                assessmentData.industry = industryKey;
                assessmentData.frameworks = industries[industryKey].frameworks;
                
                const industryCards = document.querySelectorAll('.industry-card');
                industryCards.forEach(card => {
                    if (card && card.classList) {
                        card.classList.remove('selected');
                    }
                });
                
                const clickedCard = event?.target?.closest?.('.industry-card');
                if (clickedCard && clickedCard.classList) {
                    clickedCard.classList.add('selected');
                }
                
                const continueBtn = document.getElementById('continue-btn');
                if (continueBtn) {
                    continueBtn.disabled = false;
                    continueBtn.style.opacity = '1';
                }
                
                console.log(`‚úÖ Industria seleccionada: ${industryKey}`);
            } catch (error) {
                console.error(`‚ùå Error en selectIndustry: ${error.message}`);
            }
        }

        // ============ COMPANY SIZE SELECTION ============
        function renderCompanySizes() {
            console.log('üè¢ Renderizando tama√±os de empresa...');
            const grid = document.getElementById('company-size-grid');
            if (!grid) {
                console.error('‚ùå company-size-grid no encontrado');
                return;
            }
            
            grid.innerHTML = '';
            
            Object.entries(companySizes).forEach(([key, size]) => {
                const card = document.createElement('div');
                card.className = `industry-card ${assessmentData.companySize === key ? 'selected' : ''}`;
                card.onclick = () => selectCompanySize(key);
                
                card.innerHTML = `
                    <div class="industry-icon">${size.icon}</div>
                    <div class="industry-name">${size.name}</div>
                    <div class="industry-frameworks">
                        <strong>${size.employees}</strong><br>
                        <strong>Presupuesto:</strong> ${size.budget}<br>
                        <strong>Nivel Esperado:</strong> ${size.expectedLevel}/5.0<br>
                        <br>
                        <em>${size.description}</em>
                    </div>
                `;
                
                grid.appendChild(card);
            });
            
            console.log(`‚úÖ ${Object.keys(companySizes).length} tama√±os de empresa renderizados`);
        }

        function selectCompanySize(sizeKey) {
            console.log(`üè¢ Seleccionando tama√±o: ${sizeKey}`);
            
            try {
                assessmentData.companySize = sizeKey;
                
                const sizeCards = document.querySelectorAll('#company-size-grid .industry-card');
                sizeCards.forEach(card => {
                    if (card && card.classList) {
                        card.classList.remove('selected');
                    }
                });
                
                const clickedCard = event?.target?.closest?.('.industry-card');
                if (clickedCard && clickedCard.classList) {
                    clickedCard.classList.add('selected');
                }
                
                const continueBtn = document.getElementById('continue-size-btn');
                if (continueBtn) {
                    continueBtn.disabled = false;
                    continueBtn.style.opacity = '1';
                }
                
                console.log(`‚úÖ Tama√±o seleccionado: ${sizeKey}`);
            } catch (error) {
                console.error(`‚ùå Error en selectCompanySize: ${error.message}`);
            }
        }

        // ============ TECHNOLOGY ASSESSMENT ============
        function renderTechnologies() {
            console.log('üîß Renderizando tecnolog√≠as...');
            renderCategoryFilters();
            renderTechGrid();
        }

        function renderCategoryFilters() {
            const container = document.getElementById('category-filters');
            const categories = ['Todas', ...new Set(Object.values(technologies).map(tech => tech.category))];
            
            container.innerHTML = '';
            categories.forEach(category => {
                const btn = document.createElement('button');
                btn.className = `filter-btn ${assessmentData.categoryFilter === category ? 'active' : ''}`;
                btn.textContent = category;
                btn.onclick = () => {
                    assessmentData.categoryFilter = category;
                    renderTechnologies();
                };
                container.appendChild(btn);
            });
        }

        function renderTechGrid() {
            const grid = document.getElementById('technologies-grid');
            grid.innerHTML = '';
            
            Object.entries(technologies)
                .filter(([name, tech]) => 
                    assessmentData.categoryFilter === 'Todas' || 
                    tech.category === assessmentData.categoryFilter
                )
                .sort((a, b) => a[1].maturityLevel - b[1].maturityLevel)
                .forEach(([name, tech]) => {
                    const isImplemented = assessmentData.techs[name];
                    
                    const card = document.createElement('div');
                    card.className = `tech-card ${isImplemented ? 'implemented' : ''}`;
                    card.onclick = () => toggleTechnology(name);
                    
                    const roi = tech.cost > 0 ? Math.round(((tech.annualSavings - tech.cost) / tech.cost) * 100) : 0;
                    
                    card.innerHTML = `
                        <div class="maturity-level">Nivel ${tech.maturityLevel}</div>
                        <div class="tech-header">
                            <div class="tech-info">
                                <span class="tech-icon">${tech.icon}</span>
                                <span class="tech-name">${name}</span>
                            </div>
                            ${isImplemented ? '<span class="tech-status">‚úÖ</span>' : ''}
                        </div>
                        <div class="tech-desc">${tech.desc}</div>
                        <div class="tech-metadata">
                            <span>üí∞ ${(tech.cost/1000).toFixed(0)}K</span>
                            <span>üìà ROI: ${roi}%</span>
                            <span>‚è±Ô∏è ${tech.implementationTime}</span>
                        </div>
                    `;
                    
                    grid.appendChild(card);
                });
        }

        function toggleTechnology(name) {
            console.log(`üîß Toggle technology: ${name}`);
            
            try {
                assessmentData.techs[name] = !assessmentData.techs[name];
                console.log(`‚úÖ ${name} ahora es:`, assessmentData.techs[name]);
                renderTechGrid();
            } catch (error) {
                console.error(`‚ùå Error en toggleTechnology: ${error.message}`);
            }
        }

        // ============ MATURITY CALCULATION ============
        function calculateMaturityLevel() {
            const implemented = Object.entries(assessmentData.techs)
                .filter(([_, selected]) => selected)
                .map(([name, _]) => technologies[name]);
            
            if (implemented.length === 0) return 1.0;
            
            const totalScore = implemented.reduce((sum, tech) => sum + tech.score, 0);
            const maxPossibleScore = Object.values(technologies).reduce((sum, tech) => sum + tech.score, 0);
            const baseProficiency = totalScore / maxPossibleScore;
            
            const companyData = companySizes[assessmentData.companySize] || companySizes.medium;
            const sizeModifier = companyData.maturityModifier;
            const expectedLevel = companyData.expectedLevel;
            
            const rawMaturity = 1 + (baseProficiency * 4);
            const contextualMaturity = rawMaturity * sizeModifier;
            const finalMaturity = Math.min(5, Math.max(1, contextualMaturity));
            
            console.log(`üìä Madurez calculada: ${finalMaturity.toFixed(2)}`);
            return finalMaturity;
        }

        // Funci√≥n auxiliar para obtener costo adaptado
        function getAdaptedCostForSize(originalCost, companySize) {
            switch(companySize) {
                case 'startup': return Math.round(originalCost * 0.3);
                case 'small': return Math.round(originalCost * 0.5);
                case 'medium': return Math.round(originalCost * 0.8);
                case 'large': return originalCost;
                case 'enterprise': return Math.round(originalCost * 1.3);
                default: return originalCost;
            }
        }

        // Funci√≥n auxiliar para generar beneficios espec√≠ficos por tecnolog√≠a y empresa
        function getBenefitForTech(tech, companySize, implementedTechs) {
            const benefits = {
                startup: {
                    'FortiGate NGFW': 'Protecci√≥n esencial sin complejidad. F√°cil de gestionar por equipos peque√±os.',
                    'FortiMail': 'Protege contra phishing que puede devastar startups. ROI inmediato.',
                    'FortiAuthenticator': 'MFA simple que cumple requisitos b√°sicos de compliance.',
                    'FortiAnalyzer': 'Visibilidad b√°sica para cumplir con auditor√≠as iniciales.',
                    'FortiEDR': 'Protecci√≥n avanzada de endpoints sin necesidad de SOC dedicado.',
                    'FortiXDR': 'Correlaci√≥n inteligente que compensa la falta de analistas internos.',
                    'FortiSIEM': 'SIEM completo que elimina la necesidad de m√∫ltiples herramientas.',
                    'FortiSASE': 'Soluci√≥n cloud-native perfecta para equipos remotos.',
                    'FortiRecon': 'Monitoreo externo autom√°tico sin recursos internos dedicados.',
                    'FortiZTA': 'Zero Trust simplificado para equipos distribuidos.',
                    'FortiWeb': 'Protecci√≥n web b√°sica sin complejidad de configuraci√≥n.',
                    'FortiSandbox': 'An√°lisis autom√°tico de amenazas sin analistas especializados.',
                    'FortiManager': 'Gesti√≥n centralizada que simplifica operaciones.',
                    'FortiSwitch': 'Infraestructura de red segura plug-and-play.',
                    'FortiAP': 'WiFi empresarial seguro sin configuraci√≥n compleja.',
                    'FortiDeceptor': 'Detecci√≥n avanzada con m√≠nima intervenci√≥n humana.',
                    'FortiCWP': 'Protecci√≥n cloud autom√°tica para aplicaciones en la nube.',
                    'FortiInsight': 'An√°lisis de comportamiento sin SOC dedicado.',
                    'FortiNAC': 'Control de acceso automatizado para redes simples.',
                    'FortiSOAR': 'Automatizaci√≥n de respuesta para equipos peque√±os.',
                    'FortiAIOps': 'IA que act√∫a como analista virtual de seguridad.',
                    'Perception Point': 'Email security avanzado con IA sin gesti√≥n compleja.'
                },
                small: {
                    'FortiGate NGFW': 'Escalabilidad para crecimiento sin cambiar infraestructura.',
                    'FortiMail': 'Protege comunicaciones cr√≠ticas de negocio en expansi√≥n.',
                    'FortiAuthenticator': 'Gesti√≥n centralizada de identidades en m√∫ltiples ubicaciones.',
                    'FortiAnalyzer': 'Reportes de compliance para certificaciones empresariales.',
                    'FortiEDR': 'Protecci√≥n que crece con su flota de dispositivos.',
                    'FortiXDR': 'Reduce complejidad operacional con correlaci√≥n autom√°tica.',
                    'FortiSIEM': 'Cumple requisitos de logging sin invertir en infraestructura.',
                    'FortiSASE': 'Conectividad segura para sucursales en expansi√≥n.',
                    'FortiRecon': 'Inteligencia de amenazas para competir con empresas grandes.',
                    'FortiZTA': 'Acceso seguro para empleados remotos e h√≠bridos.',
                    'FortiWeb': 'Protege aplicaciones web cr√≠ticas para el negocio.',
                    'FortiSandbox': 'Detecci√≥n de amenazas avanzadas cost-effective.',
                    'FortiManager': 'Gesti√≥n eficiente de pol√≠ticas multi-site.',
                    'FortiSwitch': 'Red escalable que soporta crecimiento empresarial.',
                    'FortiAP': 'Cobertura WiFi confiable para oficinas en expansi√≥n.',
                    'FortiDeceptor': 'Early warning system para amenazas sofisticadas.',
                    'FortiCWP': 'Protecci√≥n cloud que escala con adopci√≥n digital.',
                    'FortiInsight': 'UEBA para detectar amenazas internas.',
                    'FortiNAC': 'Control granular de acceso en redes complejas.',
                    'FortiSOAR': 'Orquestaci√≥n que optimiza recursos limitados.',
                    'FortiAIOps': 'Inteligencia artificial que amplifica capacidades del equipo.',
                    'Perception Point': 'Protecci√≥n email premium sin overhead operacional.'
                },
                medium: {
                    'FortiGate NGFW': 'Protecci√≥n robusta para m√∫ltiples ubicaciones y usuarios.',
                    'FortiMail': 'Protege colaboraci√≥n empresarial y comunicaciones estrat√©gicas.',
                    'FortiAuthenticator': 'Integraci√≥n con Active Directory y sistemas empresariales.',
                    'FortiAnalyzer': 'Analytics detallados para optimizaci√≥n de seguridad.',
                    'FortiEDR': 'Respuesta automatizada que reduce tiempo de resoluci√≥n.',
                    'FortiXDR': 'Visibilidad unificada de infraestructura compleja.',
                    'FortiSIEM': 'Compliance avanzado con correlaci√≥n de eventos empresariales.',
                    'FortiSASE': 'Optimiza conectividad WAN y reduce costos de infraestructura.',
                    'FortiRecon': 'Threat intelligence para proteger activos digitales.',
                    'FortiZTA': 'Arquitectura Zero Trust para transformaci√≥n digital.',
                    'FortiWeb': 'WAF empresarial con protecci√≥n DDoS integrada.',
                    'FortiSandbox': 'An√°lisis forense avanzado y threat intelligence.',
                    'FortiManager': 'Gesti√≥n centralizada para compliance y auditoria.',
                    'FortiSwitch': 'Segmentaci√≥n de red y microsegmentaci√≥n.',
                    'FortiAP': 'Infraestructura inal√°mbrica empresarial con analytics.',
                    'FortiDeceptor': 'Threat hunting proactivo con honeypots inteligentes.',
                    'FortiCWP': 'DevSecOps y protecci√≥n de cargas de trabajo h√≠bridas.',
                    'FortiInsight': 'Behavioral analytics para detectar APTs.',
                    'FortiNAC': 'NAC empresarial con integraci√≥n IoT.',
                    'FortiSOAR': 'Playbooks automatizados para incidentes complejos.',
                    'FortiAIOps': 'Machine learning para optimizaci√≥n de seguridad.',
                    'Perception Point': 'Advanced email security con sandbox integrado.'
                },
                large: {
                    'FortiGate NGFW': 'Protecci√≥n perimetral para operaciones globales complejas.',
                    'FortiMail': 'Protege comunicaciones ejecutivas y informaci√≥n confidencial.',
                    'FortiAuthenticator': 'SSO empresarial y gesti√≥n de privilegios avanzada.',
                    'FortiAnalyzer': 'Business intelligence para decisiones de seguridad estrat√©gicas.',
                    'FortiEDR': 'Protecci√≥n enterprise con integraci√≥n a herramientas existentes.',
                    'FortiXDR': 'Threat hunting avanzado y respuesta orquestada.',
                    'FortiSIEM': 'Cumplimiento regulatorio en m√∫ltiples jurisdicciones.',
                    'FortiSASE': 'Arquitectura Zero Trust para transformaci√≥n digital.',
                    'FortiRecon': 'Inteligencia de amenazas avanzada para protecci√≥n proactiva.',
                    'FortiZTA': 'Zero Trust completo para operaciones globales seguras.',
                    'FortiWeb': 'WAF de grado carrier con protecci√≥n API avanzada.',
                    'FortiSandbox': 'Threat intelligence customizada y an√°lisis forense.',
                    'FortiManager': 'Governance y compliance automatizado global.',
                    'FortiSwitch': 'Infraestructura de red de clase carrier.',
                    'FortiAP': 'WiFi 6E empresarial con location analytics.',
                    'FortiDeceptor': 'Deception technology para amenazas nation-state.',
                    'FortiCWP': 'Cloud security posture management avanzado.',
                    'FortiInsight': 'AI-powered behavioral analytics para amenazas sofisticadas.',
                    'FortiNAC': 'NAC de grado enterprise con zero trust network access.',
                    'FortiSOAR': 'Orquestaci√≥n avanzada con threat intelligence feeds.',
                    'FortiAIOps': 'AI operations para SOC de pr√≥xima generaci√≥n.',
                    'Perception Point': 'Email security l√≠der en la industria con threat prevention.'
                },
                enterprise: {
                    'FortiGate NGFW': 'Protecci√≥n de clase carrier para infraestructura cr√≠tica.',
                    'FortiMail': 'Protege IP y comunicaciones de alta sensibilidad.',
                    'FortiAuthenticator': 'Gesti√≥n de identidades para ecosistemas complejos.',
                    'FortiAnalyzer': 'Analytics predictivos y machine learning empresarial.',
                    'FortiEDR': 'Protecci√≥n premium con respuesta en tiempo real.',
                    'FortiXDR': 'Inteligencia de amenazas customizada y threat hunting.',
                    'FortiSIEM': 'Compliance autom√°tico y reporting ejecutivo.',
                    'FortiSASE': 'Liderazgo en innovaci√≥n Zero Trust a escala global.',
                    'FortiRecon': 'Inteligencia de amenazas de nivel nacional para protecci√≥n cr√≠tica.',
                    'FortiZTA': 'Zero Trust de pr√≥xima generaci√≥n para liderazgo tecnol√≥gico.',
                    'FortiWeb': 'WAF de nivel gubernamental con protecci√≥n cr√≠tica.',
                    'FortiSandbox': 'Threat intelligence de grado nacional con an√°lisis predictivo.',
                    'FortiManager': 'Governance automatizado para infraestructura cr√≠tica.',
                    'FortiSwitch': 'Infraestructura de red de grado militar.',
                    'FortiAP': 'Conectividad inal√°mbrica de misi√≥n cr√≠tica.',
                    'FortiDeceptor': 'Deception avanzado para amenazas de estado-naci√≥n.',
                    'FortiCWP': 'Cloud security de grado gubernamental.',
                    'FortiInsight': 'AI behavioral analytics para amenazas de APT avanzadas.',
                    'FortiNAC': 'Network access control de grado militar.',
                    'FortiSOAR': 'Orquestaci√≥n de respuesta para amenazas cr√≠ticas.',
                    'FortiAIOps': 'AI operations que define el futuro de cybersecurity.',
                    'Perception Point': 'Email protection de grado gubernamental con threat prevention.'
                }
            };

            // Buscar beneficio espec√≠fico
            const sizeBenefits = benefits[companySize] || benefits.medium;
            let specificBenefit = sizeBenefits[tech.name];

            // Si no hay beneficio espec√≠fico, generar uno basado en lo implementado
            if (!specificBenefit) {
                const hasBasics = implementedTechs && implementedTechs.some(t => t.maturityLevel <= 2);
                const hasAdvanced = implementedTechs && implementedTechs.some(t => t.maturityLevel >= 4);

                if (tech.maturityLevel <= 2 && !hasBasics) {
                    specificBenefit = "Establece fundamentos de seguridad esenciales para su organizaci√≥n.";
                } else if (tech.maturityLevel >= 4 && hasBasics) {
                    specificBenefit = "Potencia su infraestructura existente con capacidades de pr√≥xima generaci√≥n.";
                } else {
                    specificBenefit = "Se integra perfectamente con su arquitectura actual para maximizar ROI.";
                }
            }

            return specificBenefit;
        }

        function getMaturityAnalysis() {
            const currentLevel = calculateMaturityLevel();
            const companyData = companySizes[assessmentData.companySize] || companySizes.medium;
            const industryData = industries[assessmentData.industry];
            const expectedLevel = companyData.expectedLevel;
            
            let analysis = {
                currentLevel: Math.round(currentLevel * 10) / 10,
                expectedLevel: expectedLevel,
                gap: expectedLevel - currentLevel,
                performance: '',
                reasoning: '',
                nextSteps: [],
                companyContext: companyData,
                industryContext: industryData
            };
            
            if (currentLevel >= expectedLevel) {
                analysis.performance = currentLevel >= expectedLevel + 0.5 ? 'L√≠der' : 'Por encima del promedio';
                analysis.reasoning = `Tu organizaci√≥n ${companyData.name} est√° ${analysis.performance.toLowerCase()} en madurez de ciberseguridad.`;
            } else if (analysis.gap <= 0.5) {
                analysis.performance = 'En el promedio';
                analysis.reasoning = `Tu organizaci√≥n est√° en l√≠nea con las expectativas para ${companyData.name}.`;
            } else {
                analysis.performance = 'Por debajo del promedio';
                analysis.reasoning = `Existe una brecha significativa entre su nivel actual y lo esperado para ${companyData.name}.`;
            }
            
            if (currentLevel < 2.0) {
                analysis.nextSteps = [
                    'Implementar controles b√°sicos de seguridad (FortiGate, FortiMail)',
                    'Establecer pol√≠ticas de seguridad fundamentales',
                    'Capacitar al equipo en mejores pr√°cticas',
                    'Definir procesos de respuesta a incidentes'
                ];
            } else if (currentLevel < 3.0) {
                analysis.nextSteps = [
                    'Implementar soluciones de detecci√≥n y an√°lisis (FortiAnalyzer, FortiEDR)',
                    'Mejorar visibilidad y monitoreo continuo',
                    'Automatizar respuestas b√°sicas',
                    'Establecer m√©tricas de seguridad'
                ];
            } else if (currentLevel < 4.0) {
                analysis.nextSteps = [
                    'Implementar XDR y SIEM avanzado (FortiXDR, FortiSIEM)',
                    'Automatizar orquestaci√≥n de respuesta (FortiSOAR)',
                    'Implementar threat hunting proactivo',
                    'Integrar intelligence de amenazas'
                ];
            } else {
                analysis.nextSteps = [
                    'Implementar arquitectura Zero Trust (FortiZTA)',
                    'Adoptar SASE completo (FortiSASE)',
                    'Integrar AI/ML en operaciones de seguridad',
                    'Liderar innovaci√≥n en la industria'
                ];
            }
            
            return analysis;
        }

        function getMaturityPhase(level) {
            if (level <= 1.5) return 'Inicial';
            if (level <= 2.5) return 'B√°sico';
            if (level <= 3.5) return 'Intermedio';
            if (level <= 4.5) return 'Avanzado';
            return 'Excelencia';
        }

        function getRecommendedTechnologies() {
            const currentLevel = calculateMaturityLevel();
            const nextLevel = Math.min(5, Math.floor(currentLevel) + 1);
            
            const recommended = Object.entries(technologies)
                .filter(([name, tech]) => {
                    return !assessmentData.techs[name] && 
                           tech.maturityLevel <= nextLevel &&
                           tech.maturityLevel >= Math.floor(currentLevel);
                })
                .map(([name, tech]) => ({ name, ...tech }))
                .sort((a, b) => b.score - a.score)
                .slice(0, 5);
            
            console.log(`üéØ Tecnolog√≠as recomendadas: ${recommended.length}`);
            return recommended;
        }

        // ============ RESULTS GENERATION ============
        function generateMaturityRoadmap() {
            console.log('üìä Generando roadmap de madurez...');
            
            try {
                const implemented = Object.entries(assessmentData.techs)
                    .filter(([_, selected]) => selected)
                    .map(([name, _]) => ({ name, ...technologies[name] }));
                
                if (implemented.length === 0) {
                    if (confirm('No has seleccionado tecnolog√≠as. ¬øQuieres ver el demo?')) {
                        loadDemo();
                        return;
                    }
                    return;
                }
                
                const maturityLevel = calculateMaturityLevel();
                const maturityPhase = getMaturityPhase(maturityLevel);
                const recommended = getRecommendedTechnologies();
                const industryData = industries[assessmentData.industry];
                const companyData = companySizes[assessmentData.companySize];
                const analysis = getMaturityAnalysis();

                results = {
                    implemented,
                    recommended,
                    maturityLevel: Math.round(maturityLevel * 10) / 10,
                    maturityPhase,
                    industryData,
                    companyData,
                    analysis,
                    totalTechnologies: Object.keys(technologies).length,
                    coveragePercentage: Math.round((implemented.length / Object.keys(technologies).length) * 100),
                    riskReduction: Math.min(implemented.reduce((sum, tech) => sum + tech.riskReduction, 0), 85),
                    totalInvestment: implemented.reduce((sum, tech) => sum + tech.cost, 0),
                    annualSavings: implemented.reduce((sum, tech) => sum + tech.annualSavings, 0)
                };
                
                console.log('üìà Resultados generados:', results);
                console.log('üéØ An√°lisis de madurez:', analysis);
                
                renderMaturityResults();
                goToStep(3);
                
            } catch (error) {
                console.error('‚ùå Error al generar roadmap:', error);
                alert('Error al generar el roadmap. Por favor intenta de nuevo.');
            }
        }

        function renderMaturityResults() {
            console.log('üé® Renderizando resultados de madurez...');
            renderMetrics();
            renderRecommendedTechnologies();
            setTimeout(() => {
                drawMaturityRoadmap();
            }, 100);
        }

        function renderMetrics() {
            const grid = document.getElementById('metrics-grid');
            const roi = results.totalInvestment > 0 ? 
                Math.round(((results.annualSavings - results.totalInvestment) / results.totalInvestment) * 100) : 0;
            
            grid.innerHTML = `
                <div class="metric-card" style="background: linear-gradient(135deg, #dbeafe, #bfdbfe);">
                    <div class="metric-value" style="color: var(--info-blue);">${results.maturityLevel}</div>
                    <div class="metric-label">Nivel Actual de Madurez</div>
                </div>
                <div class="metric-card" style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe);">
                    <div class="metric-value" style="color: #0284c7;">${results.analysis.expectedLevel}</div>
                    <div class="metric-label">Nivel Esperado (${results.companyData.name})</div>
                </div>
                <div class="metric-card" style="background: linear-gradient(135deg, ${results.analysis.gap <= 0 ? '#dcfce7, #bbf7d0' : '#fef3c7, #fde68a'});">
                    <div class="metric-value" style="color: ${results.analysis.gap <= 0 ? 'var(--success-green)' : 'var(--warning-orange)'};">${results.analysis.performance}</div>
                    <div class="metric-label">Performance vs Industria</div>
                </div>
                <div class="metric-card" style="background: linear-gradient(135deg, #dcfce7, #bbf7d0);">
                    <div class="metric-value" style="color: var(--success-green);">${results.implemented.length}</div>
                    <div class="metric-label">Tecnolog√≠as Implementadas</div>
                </div>
                <div class="metric-card" style="background: linear-gradient(135deg, #fdf4ff, #f3e8ff);">
                    <div class="metric-value" style="color: #a855f7;">${roi}%</div>
                    <div class="metric-label">ROI Actual</div>
                </div>
                <div class="metric-card" style="background: linear-gradient(135deg, #fee2e2, #fecaca);">
                    <div class="metric-value" style="color: var(--fortinet-red);">${results.riskReduction}%</div>
                    <div class="metric-label">Reducci√≥n de Riesgo</div>
                </div>
            `;
        }

        function renderRecommendedTechnologies() {
            const container = document.getElementById('recommended-techs');
            
            const analysisHtml = `
                <div style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 20px; padding: 30px; margin-bottom: 30px; border: 2px solid #0284c7;">
                    <h3 style="color: #0c4a6e; margin-bottom: 20px; display: flex; align-items: center;">
                        <span style="font-size: 32px; margin-right: 15px;">üìä</span>
                        An√°lisis de Madurez Contextual
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                        <div style="text-align: center;">
                            <div style="font-size: 48px; font-weight: bold; color: var(--info-blue);">${results.maturityLevel}</div>
                            <div style="color: #6b7280; font-weight: 600;">Nivel Actual</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 48px; font-weight: bold; color: ${results.analysis.gap <= 0 ? 'var(--success-green)' : 'var(--warning-orange)'};">${results.analysis.expectedLevel}</div>
                            <div style="color: #6b7280; font-weight: 600;">Nivel Esperado</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: ${results.analysis.gap <= 0 ? 'var(--success-green)' : 'var(--fortinet-red)'};">${results.analysis.performance}</div>
                            <div style="color: #6b7280; font-weight: 600;">Performance</div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.7); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="color: #374151; margin-bottom: 10px;">üí° An√°lisis para ${results.companyData.name}</h4>
                        <p style="color: #6b7280; line-height: 1.6; margin-bottom: 15px;">${results.analysis.reasoning}</p>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                            <div>
                                <h5 style="color: #059669; margin-bottom: 8px;">üéØ Prioridades de ${results.companyData.name}</h5>
                                <ul style="color: #6b7280; font-size: 14px; margin-left: 20px;">
                                    ${results.companyData.priorities.map(p => `<li>${p}</li>`).join('')}
                                </ul>
                            </div>
                            <div>
                                <h5 style="color: #dc2626; margin-bottom: 8px;">‚ö†Ô∏è Desaf√≠os T√≠picos</h5>
                                <ul style="color: #6b7280; font-size: 14px; margin-left: 20px;">
                                    ${results.companyData.challenges.map(c => `<li>${c}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.7); border-radius: 15px; padding: 20px;">
                        <h4 style="color: #374151; margin-bottom: 10px;">üöÄ Pr√≥ximos Pasos Estrat√©gicos</h4>
                        <ol style="color: #6b7280; line-height: 1.6; margin-left: 20px;">
                            ${results.analysis.nextSteps.map(step => `<li style="margin-bottom: 8px;">${step}</li>`).join('')}
                        </ol>
                    </div>
                </div>
            `;
            
            if (results.recommended.length === 0) {
                container.innerHTML = analysisHtml + `
                    <div style="text-align: center; padding: 40px; background: linear-gradient(135deg, #f0fdf4, #dcfce7); border-radius: 20px;">
                        <h3 style="color: var(--success-green); margin-bottom: 15px;">üéâ ¬°Excelente! Has alcanzado un nivel superior de madurez</h3>
                        <p style="color: #059669;">Tu organizaci√≥n ha implementado un portafolio avanzado de Fortinet Security Fabric</p>
                        <p style="color: #6b7280; margin-top: 15px;">Considera tecnolog√≠as de vanguardia como FortiSASE o FortiAIOps para mantener el liderazgo</p>
                    </div>
                `;
                return;
            }
            
            const recommendationsHtml = `
                <h3 style="color: var(--info-blue); margin-bottom: 25px; text-align: center;">
                    üéØ Roadmap Personalizado para ${results.companyData.name}
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px;">
                    ${results.recommended.map((tech, idx) => {
                        const roi = tech.cost > 0 ? Math.round(((tech.annualSavings - tech.cost) / tech.cost) * 100) : 0;
                        const priorities = ['üî• Cr√≠tica', '‚ö° Alta', 'üìà Media-Alta', 'üí° Media', 'üîß Baja'];
                        const priority = priorities[idx] || 'üîß Baja';
                        const priorityColors = ['#dc2626', '#f97316', '#d97706', '#0891b2', '#6b7280'];
                        const priorityColor = priorityColors[idx] || '#6b7280';
                        
                        // Personalizaci√≥n seg√∫n tama√±o de empresa
                        const companySize = results.companyData;
                        let adaptedCost = tech.cost;
                        let adaptedROI = roi;
                        let adaptedTime = tech.implementationTime;
                        let sizeFactor = 1;
                        
                        // Ajustar costos y tiempos seg√∫n tama√±o
                        switch(assessmentData.companySize) {
                            case 'startup':
                                sizeFactor = 0.6;
                                adaptedCost = Math.round(tech.cost * 0.3); // Versi√≥n m√°s b√°sica
                                adaptedTime = tech.implementationTime.replace(/(\d+)-(\d+)/, (match, p1, p2) => 
                                    `${Math.max(1, Math.floor(parseInt(p1) * 0.7))}-${Math.floor(parseInt(p2) * 0.7)}`);
                                break;
                            case 'small':
                                sizeFactor = 0.75;
                                adaptedCost = Math.round(tech.cost * 0.5); // Versi√≥n escalable
                                adaptedTime = tech.implementationTime.replace(/(\d+)-(\d+)/, (match, p1, p2) => 
                                    `${Math.max(1, Math.floor(parseInt(p1) * 0.8))}-${Math.floor(parseInt(p2) * 0.8)}`);
                                break;
                            case 'medium':
                                sizeFactor = 1;
                                adaptedCost = Math.round(tech.cost * 0.8); // Implementaci√≥n est√°ndar
                                break;
                            case 'large':
                                sizeFactor = 1.2;
                                adaptedCost = tech.cost; // Precio completo
                                break;
                            case 'enterprise':
                                sizeFactor = 1.5;
                                adaptedCost = Math.round(tech.cost * 1.3); // Versi√≥n enterprise con extras
                                adaptedTime = tech.implementationTime.replace(/(\d+)-(\d+)/, (match, p1, p2) => 
                                    `${Math.floor(parseInt(p1) * 1.2)}-${Math.floor(parseInt(p2) * 1.3)}`);
                                break;
                        }
                        
                        adaptedROI = adaptedCost > 0 ? Math.round(((tech.annualSavings * sizeFactor - adaptedCost) / adaptedCost) * 100) : 0;
                        
                        // Mensaje personalizado seg√∫n tama√±o
                        const sizeSpecificMessage = (() => {
                            switch(assessmentData.companySize) {
                                case 'startup':
                                    return `Versi√≥n b√°sica ideal para startups. Implementaci√≥n r√°pida y costo-efectiva con escalabilidad futura garantizada.`;
                                case 'small':
                                    return `Soluci√≥n escalable para empresas peque√±as. Balance perfecto entre funcionalidad y presupuesto.`;
                                case 'medium':
                                    return `Implementaci√≥n est√°ndar para empresas medianas. Funcionalidades completas para m√∫ltiples ubicaciones.`;
                                case 'large':
                                    return `Soluci√≥n empresarial robusta. Capacidades avanzadas para operaciones globales y compliance estricto.`;
                                case 'enterprise':
                                    return `Implementaci√≥n enterprise premium. M√°ximas capacidades, integraci√≥n personalizada y soporte 24/7.`;
                                default:
                                    return `Soluci√≥n adaptada a las necesidades espec√≠ficas de su organizaci√≥n.`;
                            }
                        })();
                        
                        return `
                            <div style="border: 2px solid ${priorityColor}; border-radius: 15px; padding: 25px; background: linear-gradient(135deg, ${priorityColor}08, #ffffff); position: relative; overflow: hidden;">
                                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, ${priorityColor}05, transparent); pointer-events: none;"></div>
                                
                                <div style="position: relative; z-index: 2;">
                                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                                        <div style="display: flex; align-items: center;">
                                            <span style="font-size: 36px; margin-right: 15px;">${tech.icon}</span>
                                            <div>
                                                <h4 style="margin: 0; color: var(--gray-900); font-size: 18px;">${tech.name}</h4>
                                                <div style="font-size: 12px; color: ${priorityColor}; font-weight: bold;">
                                                    Nivel ${tech.maturityLevel} ‚Ä¢ ${tech.category}
                                                </div>
                                            </div>
                                        </div>
                                        <div style="background: ${priorityColor}; color: white; padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: bold;">
                                            ${priority}
                                        </div>
                                    </div>
                                    
                                    <p style="color: var(--gray-600); font-size: 14px; margin-bottom: 15px; line-height: 1.5;">${tech.desc}</p>
                                    
                                    <!-- Indicador de tama√±o de empresa -->
                                    <div style="background: linear-gradient(135deg, ${priorityColor}15, ${priorityColor}08); border-radius: 10px; padding: 12px; margin-bottom: 15px; border-left: 4px solid ${priorityColor};">
                                        <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                            <span style="font-size: 18px; margin-right: 8px;">${companySize.icon}</span>
                                            <strong style="color: ${priorityColor}; font-size: 13px;">Adaptado para ${companySize.name}</strong>
                                        </div>
                                        <p style="color: #374151; margin: 0; font-size: 12px; line-height: 1.4;">
                                            ${sizeSpecificMessage}
                                        </p>
                                    </div>
                                    
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px; font-size: 12px;">
                                        <div style="background: rgba(255,255,255,0.8); padding: 8px; border-radius: 8px;">
                                            <strong>üí∞ Inversi√≥n:</strong> ${(adaptedCost/1000).toFixed(0)}K
                                            ${adaptedCost !== tech.cost ? `<br><small style="color: #6b7280;">Lista: ${(tech.cost/1000).toFixed(0)}K</small>` : ''}
                                        </div>
                                        <div style="background: rgba(255,255,255,0.8); padding: 8px; border-radius: 8px;">
                                            <strong>üìà ROI:</strong> ${adaptedROI}%
                                            ${Math.abs(adaptedROI - roi) > 5 ? `<br><small style="color: #6b7280;">Est√°ndar: ${roi}%</small>` : ''}
                                        </div>
                                        <div style="background: rgba(255,255,255,0.8); padding: 8px; border-radius: 8px;">
                                            <strong>‚è±Ô∏è Tiempo:</strong> ${adaptedTime}
                                        </div>
                                        <div style="background: rgba(255,255,255,0.8); padding: 8px; border-radius: 8px;">
                                            <strong>üõ°Ô∏è Riesgo:</strong> -${tech.riskReduction}%
                                        </div>
                                    </div>
                                    
                                    <div style="background: ${priorityColor}15; border-radius: 10px; padding: 12px; font-size: 12px;">
                                        <strong style="color: ${priorityColor};">Beneficio Espec√≠fico para ${companySize.name}:</strong>
                                        <p style="color: #374151; margin: 5px 0 0 0; line-height: 1.4;">
                                            ${getBenefitForTech(tech, assessmentData.companySize, results.implemented)}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            
            container.innerHTML = analysisHtml + recommendationsHtml;
        }

        // ============ VISUAL ROADMAP MEJORADO SIN "BAILE" ============
        function drawMaturityRoadmap() {
            console.log('üó∫Ô∏è Dibujando roadmap visual sin "baile"...');
            
            const canvas = document.getElementById('roadmap-canvas');
            if (!canvas || !results) return;

            const rect = canvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            
            const ctx = canvas.getContext('2d');
            ctx.scale(dpr, dpr);
            
            const width = rect.width;
            const height = rect.height;

            setupCanvasInteractivity(canvas, ctx, width, height);

            function animate() {
                drawRoadmapFrame(ctx, width, height);
                animationFrame = requestAnimationFrame(animate);
            }
            
            if (animationFrame) {
                cancelAnimationFrame(animationFrame);
            }
            
            animate();
        }

        function setupCanvasInteractivity(canvas, ctx, width, height) {
            canvas.addEventListener('wheel', (e) => {
                e.preventDefault();
                const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
                canvasScale *= zoomFactor;
                canvasScale = Math.max(0.3, Math.min(5, canvasScale));
                console.log(`üîç Zoom: ${canvasScale.toFixed(2)}`);
            });

            canvas.addEventListener('mousedown', (e) => {
                isDragging = true;
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
                canvas.style.cursor = 'grabbing';
            });

            canvas.addEventListener('mousemove', (e) => {
                const rect = canvas.getBoundingClientRect();
                const mouseX = (e.clientX - rect.left) / canvasScale - canvasOffsetX;
                const mouseY = (e.clientY - rect.top) / canvasScale - canvasOffsetY;

                if (isDragging) {
                    const deltaX = e.clientX - lastMouseX;
                    const deltaY = e.clientY - lastMouseY;
                    
                    canvasOffsetX += deltaX / canvasScale;
                    canvasOffsetY += deltaY / canvasScale;
                    
                    lastMouseX = e.clientX;
                    lastMouseY = e.clientY;
                } else {
                    hoveredNode = getNodeAtPosition(mouseX, mouseY);
                    canvas.style.cursor = hoveredNode ? 'pointer' : 'grab';
                }
            });

            canvas.addEventListener('mouseup', () => {
                isDragging = false;
                canvas.style.cursor = hoveredNode ? 'pointer' : 'grab';
            });

            canvas.addEventListener('mouseleave', () => {
                isDragging = false;
                hoveredNode = null;
                canvas.style.cursor = 'grab';
            });

            canvas.addEventListener('click', (e) => {
                if (hoveredNode) {
                    showTechnologyDetails(hoveredNode);
                }
            });
        }

        function drawRoadmapFrame(ctx, width, height) {
            ctx.save();
            ctx.clearRect(0, 0, width, height);
            ctx.scale(canvasScale, canvasScale);
            ctx.translate(canvasOffsetX, canvasOffsetY);

            drawRoadmapContent(ctx, width / canvasScale, height / canvasScale);
            
            ctx.restore();
        }

        function drawRoadmapContent(ctx, width, height) {
            ctx.clearRect(0, 0, width, height);

            // Fondo con gradiente
            const bgGradient = ctx.createLinearGradient(0, 0, 0, height);
            bgGradient.addColorStop(0, '#f8fafc');
            bgGradient.addColorStop(0.5, '#ffffff');
            bgGradient.addColorStop(1, '#f1f5f9');
            ctx.fillStyle = bgGradient;
            ctx.fillRect(0, 0, width, height);

            // T√≠tulo
            ctx.fillStyle = '#E31E24';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üõ°Ô∏è FORTINET SECURITY FABRIC - ROADMAP DE MADUREZ', width / 2, 40);

            ctx.fillStyle = '#333333';
            ctx.font = 'bold 16px Arial';
            const viewText = showCompleteRoadmap ? 'ROADMAP COMPLETO - TODAS LAS TECNOLOG√çAS' : `${results.industryData.name} - Nivel ${results.maturityLevel}/5.0 (${results.maturityPhase})`;
            ctx.fillText(viewText, width / 2, 65);

            // Curva de madurez
            const margin = 80;
            const curveStartX = margin;
            const curveStartY = height - margin;
            const curveEndX = width - margin;
            const curveEndY = margin + 60;

            // Niveles de madurez como zonas
            const maturityLevels = [
                { name: 'Inicial', level: 1, color: '#dc2626', x: 0.0 },
                { name: 'B√°sico', level: 2, color: '#f97316', x: 0.2 },
                { name: 'Intermedio', level: 3, color: '#0891b2', x: 0.4 },
                { name: 'Avanzado', level: 4, color: '#059669', x: 0.6 },
                { name: 'Excelencia', level: 5, color: '#7c3aed', x: 0.8 }
            ];

            maturityLevels.forEach((level, idx) => {
                const x = curveStartX + (curveEndX - curveStartX) * level.x;
                const nextX = idx < maturityLevels.length - 1 ? 
                    curveStartX + (curveEndX - curveStartX) * maturityLevels[idx + 1].x : curveEndX;
                const zoneWidth = nextX - x;

                // Zona de madurez
                ctx.fillStyle = level.color + '15';
                ctx.fillRect(x, curveEndY - 20, zoneWidth, curveStartY - curveEndY + 40);

                // L√≠nea divisoria
                if (idx < maturityLevels.length - 1) {
                    ctx.strokeStyle = level.color + '40';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([5, 5]);
                    ctx.beginPath();
                    ctx.moveTo(nextX, curveEndY - 20);
                    ctx.lineTo(nextX, curveStartY + 20);
                    ctx.stroke();
                    ctx.setLineDash([]);
                }

                // Etiqueta del nivel
                ctx.fillStyle = level.color;
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`Nivel ${level.level}`, x + zoneWidth/2, curveEndY - 30);
                ctx.font = '12px Arial';
                ctx.fillText(level.name, x + zoneWidth/2, curveEndY - 15);
            });

            // Curva principal
            ctx.strokeStyle = '#cbd5e1';
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(curveStartX, curveStartY);
            
            const cp1X = curveStartX + (curveEndX - curveStartX) * 0.3;
            const cp1Y = curveStartY - (curveStartY - curveEndY) * 0.2;
            const cp2X = curveStartX + (curveEndX - curveStartX) * 0.7;
            const cp2Y = curveEndY + (curveStartY - curveEndY) * 0.2;
            
            ctx.bezierCurveTo(cp1X, cp1Y, cp2X, cp2Y, curveEndX, curveEndY);
            ctx.stroke();

            // Progreso actual (SIEMPRE mostrar, incluso en vista completa)
            const currentProgress = Math.min((results.maturityLevel - 1) / 4, 1);
            const t = currentProgress;
            const currentX = Math.pow(1-t, 3) * curveStartX + 
                           3 * Math.pow(1-t, 2) * t * cp1X + 
                           3 * (1-t) * Math.pow(t, 2) * cp2X + 
                           Math.pow(t, 3) * curveEndX;
            const currentY = Math.pow(1-t, 3) * curveStartY + 
                           3 * Math.pow(1-t, 2) * t * cp1Y + 
                           3 * (1-t) * Math.pow(t, 2) * cp2Y + 
                           Math.pow(t, 3) * curveEndY;

            // L√≠nea de progreso (solo en vista actual)
            if (!showCompleteRoadmap && currentProgress > 0) {
                const progressGradient = ctx.createLinearGradient(curveStartX, curveStartY, currentX, currentY);
                progressGradient.addColorStop(0, '#10b981');
                progressGradient.addColorStop(1, '#059669');
                
                ctx.strokeStyle = progressGradient;
                ctx.lineWidth = 12;
                ctx.beginPath();
                ctx.moveTo(curveStartX, curveStartY);
                ctx.bezierCurveTo(cp1X * currentProgress, cp1Y, cp2X * currentProgress, cp2Y, currentX, currentY);
                ctx.stroke();
            }

            // Marcador "Usted se encuentra aqu√≠" (SIEMPRE visible)
            // C√≠rculo exterior pulsante
            const pulseSize = showCompleteRoadmap ? 18 : 16;
            ctx.fillStyle = showCompleteRoadmap ? '#E31E24' : '#dc2626';
            ctx.shadowColor = showCompleteRoadmap ? 'rgba(227, 30, 36, 0.6)' : 'rgba(220, 38, 38, 0.5)';
            ctx.shadowBlur = showCompleteRoadmap ? 20 : 15;
            ctx.beginPath();
            ctx.arc(currentX, currentY, pulseSize, 0, 2 * Math.PI);
            ctx.fill();
            ctx.shadowBlur = 0;

            // C√≠rculo interior
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(currentX, currentY, pulseSize - 4, 0, 2 * Math.PI);
            ctx.fill();

            // Icono central
            ctx.fillStyle = showCompleteRoadmap ? '#E31E24' : '#dc2626';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üìç', currentX, currentY + 5);

            // Etiqueta "Usted se encuentra aqu√≠"
            if (showCompleteRoadmap) {
                // Fondo para la etiqueta
                const labelText = 'USTED SE ENCUENTRA AQU√ç';
                ctx.font = 'bold 11px Arial';
                const textWidth = ctx.measureText(labelText).width;
                const labelX = currentX - textWidth/2 - 8;
                const labelY = currentY - 35;
                
                ctx.fillStyle = '#E31E24';
                ctx.fillRect(labelX, labelY - 12, textWidth + 16, 20);
                
                // Tri√°ngulo apuntando al marcador
                ctx.beginPath();
                ctx.moveTo(currentX, labelY + 8);
                ctx.lineTo(currentX - 6, labelY + 14);
                ctx.lineTo(currentX + 6, labelY + 14);
                ctx.closePath();
                ctx.fill();
                
                // Texto de la etiqueta
                ctx.fillStyle = 'white';
                ctx.textAlign = 'center';
                ctx.fillText(labelText, currentX, labelY - 2);
                
                // Nivel de madurez debajo del marcador
                ctx.fillStyle = '#E31E24';
                ctx.font = 'bold 10px Arial';
                ctx.fillText(`Nivel ${results.maturityLevel}`, currentX, currentY + 35);
            }

            // Dibujar tecnolog√≠as usando posiciones fijas
            drawTechnologiesOnRoadmap(ctx, curveStartX, curveStartY, curveEndX, curveEndY, cp1X, cp1Y, cp2X, cp2Y, width, height);

            // Meta final
            ctx.fillStyle = '#7c3aed';
            ctx.shadowColor = 'rgba(124, 58, 237, 0.5)';
            ctx.shadowBlur = 20;
            ctx.beginPath();
            ctx.arc(curveEndX, curveEndY, 20, 0, 2 * Math.PI);
            ctx.fill();
            ctx.shadowBlur = 0;

            ctx.fillStyle = 'white';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üéØ', curveEndX, curveEndY + 6);

            // Etiqueta meta
            ctx.fillStyle = '#7c3aed';
            ctx.font = 'bold 12px Arial';
            ctx.fillText('Excelencia', curveEndX, curveEndY - 30);
            ctx.font = '10px Arial';
            ctx.fillText('Zero Trust & AI', curveEndX, curveEndY - 18);

            // Informaci√≥n inferior
            ctx.fillStyle = '#374151';
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            
            if (showCompleteRoadmap) {
                ctx.fillText(`üó∫Ô∏è Roadmap Completo: ${Object.keys(technologies).length} tecnolog√≠as de Fortinet Security Fabric`, 
                            margin, height - 50);
                ctx.fillText(`üìä Cobertura de Portfolio: Desde Inicial hasta Excelencia (Niveles 1-5)`, 
                            margin, height - 35);
                ctx.fillText(`üéØ Use este roadmap para planificar su evoluci√≥n de seguridad a largo plazo`, 
                            margin, height - 20);
            } else {
                ctx.fillText(`üìä Portfolio Implementado: ${results.implemented.length}/${results.totalTechnologies} tecnolog√≠as (${results.coveragePercentage}%)`, 
                            margin, height - 50);
                ctx.fillText(`üéØ Pr√≥ximos Pasos: ${results.recommended.length} tecnolog√≠as recomendadas para el siguiente nivel`, 
                            margin, height - 35);
                ctx.fillText(`üí∞ ROI Actual: ${results.totalInvestment > 0 ? Math.round(((results.annualSavings - results.totalInvestment) / results.totalInvestment) * 100) : 0}% | üõ°Ô∏è Reducci√≥n de Riesgo: ${results.riskReduction}%`, 
                            margin, height - 20);
            }

            console.log('‚úÖ Roadmap dibujado correctamente');
        }

        function drawTechnologiesOnRoadmap(ctx, startX, startY, endX, endY, cp1X, cp1Y, cp2X, cp2Y, width, height) {
            // Determinar qu√© tecnolog√≠as mostrar
            let techsToShow = [];
            
            if (showCompleteRoadmap) {
                // Mostrar TODAS las tecnolog√≠as
                techsToShow = Object.entries(technologies).map(([name, tech]) => ({
                    name,
                    ...tech,
                    implemented: false // En vista completa, ninguna est√° "implementada" visualmente
                }));
            } else {
                // Mostrar solo implementadas + recomendadas
                const implementedTechs = results.implemented.map(tech => ({ ...tech, implemented: true }));
                const recommendedTechs = results.recommended.slice(0, 3).map(tech => ({ ...tech, implemented: false }));
                techsToShow = [...implementedTechs, ...recommendedTechs];
            }

            console.log(`üé® Dibujando ${techsToShow.length} tecnolog√≠as`);

            techsToShow.forEach((tech, index) => {
                // Usar posici√≥n fija definida en la data
                const position = tech.position;
                if (!position) {
                    console.warn(`‚ö†Ô∏è ${tech.name} no tiene posici√≥n definida`);
                    return;
                }

                // Calcular coordenadas en la curva usando posici√≥n fija
                const t = position.x;
                const curveX = Math.pow(1-t, 3) * startX + 
                              3 * Math.pow(1-t, 2) * t * cp1X + 
                              3 * (1-t) * Math.pow(t, 2) * cp2X + 
                              Math.pow(t, 3) * endX;
                const curveY = Math.pow(1-t, 3) * startY + 
                              3 * Math.pow(1-t, 2) * t * cp1Y + 
                              3 * (1-t) * Math.pow(t, 2) * cp2Y + 
                              Math.pow(t, 3) * endY;

                // Offset vertical fijo basado en 'side'
                const offsetY = position.side === 'above' ? -60 : 60;
                const nodeX = curveX;
                const nodeY = curveY + offsetY;

                // L√≠nea conectora
                const lineColor = showCompleteRoadmap ? 
                    (tech.maturityLevel <= 2 ? '#10b981' : tech.maturityLevel <= 4 ? '#0891b2' : '#7c3aed') :
                    (tech.implemented ? '#10b981' : '#6b7280');
                    
                ctx.strokeStyle = lineColor;
                ctx.lineWidth = showCompleteRoadmap ? 2 : 3;
                ctx.setLineDash(tech.implemented ? [] : [4, 8]);
                ctx.beginPath();
                ctx.moveTo(curveX, curveY);
                ctx.lineTo(nodeX, nodeY);
                ctx.stroke();
                ctx.setLineDash([]);

                // Nodo de tecnolog√≠a
                const nodeColor = showCompleteRoadmap ? 
                    (tech.maturityLevel <= 2 ? '#10b981' : tech.maturityLevel <= 4 ? '#0891b2' : '#7c3aed') :
                    (tech.implemented ? '#10b981' : '#6b7280');
                    
                ctx.fillStyle = nodeColor;
                ctx.shadowColor = `${nodeColor}40`;
                ctx.shadowBlur = tech.implemented ? 10 : 8;
                ctx.beginPath();
                ctx.arc(nodeX, nodeY, tech.implemented ? 18 : 16, 0, 2 * Math.PI);
                ctx.fill();
                ctx.shadowBlur = 0;

                // Borde para no implementadas
                if (!tech.implemented) {
                    ctx.strokeStyle = '#374151';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(nodeX, nodeY, 16, 0, 2 * Math.PI);
                    ctx.stroke();
                }

                // Icono
                ctx.fillStyle = 'white';
                ctx.font = `bold ${tech.implemented ? '16px' : '14px'} Arial`;
                ctx.textAlign = 'center';
                ctx.fillText(tech.icon, nodeX, nodeY + (tech.implemented ? 5 : 4));

                // Nombre
                ctx.fillStyle = '#374151';
                ctx.font = `bold ${showCompleteRoadmap ? '9px' : '11px'} Arial`;
                const techName = tech.name.length > 12 ? tech.name.substring(0, 10) + '..' : tech.name;
                const labelY = nodeY + (position.side === 'above' ? -25 : 30);
                ctx.fillText(techName, nodeX, labelY);

                // Indicador de nivel en vista completa
                if (showCompleteRoadmap) {
                    ctx.fillStyle = nodeColor;
                    ctx.font = '8px Arial';
                    ctx.fillText(`L${tech.maturityLevel}`, nodeX + 12, nodeY - 12);
                }

                // Indicador de prioridad para recomendadas
                if (!tech.implemented && !showCompleteRoadmap && index < 3) {
                    ctx.fillStyle = '#f59e0b';
                    ctx.font = '8px Arial';
                    ctx.fillText(`#${index + 1}`, nodeX + 12, nodeY - 12);
                }
            });
        }

        function getNodeAtPosition(x, y) {
            // Simplificado para este ejemplo
            return null;
        }

        function showTechnologyDetails(tech) {
            alert(`Tecnolog√≠a: ${tech.name}\nNivel: ${tech.maturityLevel}\nCategor√≠a: ${tech.category}`);
        }

        // ============ CANVAS CONTROLS ============
        function zoomCanvas(factor) {
            canvasScale *= factor;
            canvasScale = Math.max(0.3, Math.min(5, canvasScale));
            console.log(`üîç Canvas zoom: ${canvasScale.toFixed(2)}`);
        }

        function resetCanvas() {
            canvasScale = 1;
            canvasOffsetX = 0;
            canvasOffsetY = 0;
            console.log('üîÑ Canvas reseteado');
        }

        function downloadRoadmap() {
            console.log('üì∏ Descargando roadmap...');
            const canvas = document.getElementById('roadmap-canvas');
            if (!canvas) {
                alert('‚ùå Error: No se encontr√≥ el roadmap');
                return;
            }

            try {
                const dataURL = canvas.toDataURL('image/png', 1.0);
                const tempLink = document.createElement('a');
                const suffix = showCompleteRoadmap ? 'Completo' : assessmentData.industry || 'assessment';
                tempLink.href = dataURL;
                tempLink.download = `Fortinet-Maturity-Roadmap-${suffix}-${new Date().toISOString().split('T')[0]}.png`;
                
                document.body.appendChild(tempLink);
                tempLink.click();
                document.body.removeChild(tempLink);
                
                console.log('‚úÖ Roadmap descargado exitosamente');
                alert('üñºÔ∏è ¬°Roadmap de madurez exportado exitosamente!');
            } catch (error) {
                console.error('‚ùå Error descargando:', error);
                alert('‚ùå Error al exportar roadmap');
            }
        }

        // Funci√≥n auxiliar para obtener costo adaptado
        function getAdaptedCostForSize(originalCost, companySize) {
            switch(companySize) {
                case 'startup': return Math.round(originalCost * 0.3);
                case 'small': return Math.round(originalCost * 0.5);
                case 'medium': return Math.round(originalCost * 0.8);
                case 'large': return originalCost;
                case 'enterprise': return Math.round(originalCost * 1.3);
                default: return originalCost;
            }
        }

        // Funci√≥n auxiliar para generar beneficios espec√≠ficos por tecnolog√≠a y empresa
        function getBenefitForTech(tech, companySize, implementedTechs) {
            const benefits = {
                startup: {
                    'FortiGate NGFW': 'Protecci√≥n esencial sin complejidad. F√°cil de gestionar por equipos peque√±os.',
                    'FortiMail': 'Protege contra phishing que puede devastar startups. ROI inmediato.',
                    'FortiAuthenticator': 'MFA simple que cumple requisitos b√°sicos de compliance.',
                    'FortiAnalyzer': 'Visibilidad b√°sica para cumplir con auditor√≠as iniciales.',
                    'FortiEDR': 'Protecci√≥n avanzada de endpoints sin necesidad de SOC dedicado.',
                    'FortiXDR': 'Correlaci√≥n inteligente que compensa la falta de analistas internos.',
                    'FortiSIEM': 'SIEM completo que elimina la necesidad de m√∫ltiples herramientas.',
                    'FortiSASE': 'Soluci√≥n cloud-native perfecta para equipos remotos.',
                    'FortiRecon': 'Monitoreo externo autom√°tico sin recursos internos dedicados.',
                    'FortiZTA': 'Zero Trust simplificado para equipos distribuidos.'
                },
                small: {
                    'FortiGate NGFW': 'Escalabilidad para crecimiento sin cambiar infraestructura.',
                    'FortiMail': 'Protege comunicaciones cr√≠ticas de negocio en expansi√≥n.',
                    'FortiAuthenticator': 'Gesti√≥n centralizada de identidades en m√∫ltiples ubicaciones.',
                    'FortiAnalyzer': 'Reportes de compliance para certificaciones empresariales.',
                    'FortiEDR': 'Protecci√≥n que crece con su flota de dispositivos.',
                    'FortiXDR': 'Reduce complejidad operacional con correlaci√≥n autom√°tica.',
                    'FortiSIEM': 'Cumple requisitos de logging sin invertir en infraestructura.',
                    'FortiSASE': 'Conectividad segura para sucursales en expansi√≥n.',
                    'FortiRecon': 'Inteligencia de amenazas para competir con empresas grandes.',
                    'FortiZTA': 'Acceso seguro para empleados remotos e h√≠bridos.'
                },
                medium: {
                    'FortiGate NGFW': 'Protecci√≥n robusta para m√∫ltiples ubicaciones y usuarios.',
                    'FortiMail': 'Protege colaboraci√≥n empresarial y comunicaciones estrat√©gicas.',
                    'FortiAuthenticator': 'Integraci√≥n con Active Directory y sistemas empresariales.',
                    'FortiAnalyzer': 'Analytics detallados para optimizaci√≥n de seguridad.',
                    'FortiEDR': 'Respuesta automatizada que reduce tiempo de resoluci√≥n.',
                    'FortiXDR': 'Visibilidad unificada de infraestructura compleja.',
                    'FortiSIEM': 'Compliance avanzado con correlaci√≥n de eventos empresariales.',
                    'FortiSASE': 'Optimiza conectividad WAN y reduce costos de infraestructura.',
                    'FortiRecon': 'Threat intelligence para proteger activos digitales.',
                    'FortiZTA': 'Arquitectura Zero Trust para transformaci√≥n digital.'
                },
                large: {
                    'FortiGate NGFW': 'Protecci√≥n perimetral para operaciones globales complejas.',
                    'FortiMail': 'Protege comunicaciones ejecutivas y informaci√≥n confidencial.',
                    'FortiAuthenticator': 'SSO empresarial y gesti√≥n de privilegios avanzada.',
                    'FortiAnalyzer': 'Business intelligence para decisiones de seguridad estrat√©gicas.',
                    'FortiEDR': 'Protecci√≥n enterprise con integraci√≥n a herramientas existentes.',
                    'FortiXDR': 'Threat hunting avanzado y respuesta orquestada.',
                    'FortiSIEM': 'Cumplimiento regulatorio en m√∫ltiples jurisdicciones.',
                    'FortiSASE': 'Arquitectura Zero Trust para transformaci√≥n digital.',
                    'FortiRecon': 'Inteligencia de amenazas avanzada para protecci√≥n proactiva.',
                    'FortiZTA': 'Zero Trust completo para operaciones globales seguras.'
                },
                enterprise: {
                    'FortiGate NGFW': 'Protecci√≥n de clase carrier para infraestructura cr√≠tica.',
                    'FortiMail': 'Protege IP y comunicaciones de alta sensibilidad.',
                    'FortiAuthenticator': 'Gesti√≥n de identidades para ecosistemas complejos.',
                    'FortiAnalyzer': 'Analytics predictivos y machine learning empresarial.',
                    'FortiEDR': 'Protecci√≥n premium con respuesta en tiempo real.',
                    'FortiXDR': 'Inteligencia de amenazas customizada y threat hunting.',
                    'FortiSIEM': 'Compliance autom√°tico y reporting ejecutivo.',
                    'FortiSASE': 'Liderazgo en innovaci√≥n Zero Trust a escala global.',
                    'FortiRecon': 'Inteligencia de amenazas de nivel nacional para protecci√≥n cr√≠tica.',
                    'FortiZTA': 'Zero Trust de pr√≥xima generaci√≥n para liderazgo tecnol√≥gico.'
                }
            };

            // Buscar beneficio espec√≠fico
            const sizeBenefits = benefits[companySize] || benefits.medium;
            let specificBenefit = sizeBenefits[tech.name];

            // Si no hay beneficio espec√≠fico, generar uno basado en lo implementado
            if (!specificBenefit) {
                const hasBasics = implementedTechs && implementedTechs.some(t => t.maturityLevel <= 2);
                const hasAdvanced = implementedTechs && implementedTechs.some(t => t.maturityLevel >= 4);

                if (tech.maturityLevel <= 2 && !hasBasics) {
                    specificBenefit = "Establece fundamentos de seguridad esenciales para su organizaci√≥n.";
                } else if (tech.maturityLevel >= 4 && hasBasics) {
                    specificBenefit = "Potencia su infraestructura existente con capacidades de pr√≥xima generaci√≥n.";
                } else {
                    specificBenefit = "Se integra perfectamente con su arquitectura actual para maximizar ROI.";
                }
            }

            return specificBenefit;
        }

        function generateReport() {
            console.log('üìÑ Generando reporte ejecutivo...');
            if (!results) {
                alert('‚ùå Error: No hay datos para el reporte');
                return;
            }

            const roi = results.totalInvestment > 0 ? 
                Math.round(((results.annualSavings - results.totalInvestment) / results.totalInvestment) * 100) : 0;

            const reportText = `FORTINET SECURITY FABRIC - REPORTE DE MADUREZ EJECUTIVO
=======================================================

RESUMEN EJECUTIVO
-----------------
Organizaci√≥n: ${results.industryData.name}
Tama√±o de Empresa: ${results.companyData.name}
Fecha de Evaluaci√≥n: ${new Date().toLocaleDateString('es-ES')}
Nivel de Madurez Actual: ${results.maturityLevel}/5.0 (${results.maturityPhase})
Performance vs Industria: ${results.analysis.performance}

AN√ÅLISIS DE PORTFOLIO ACTUAL
-----------------------------
‚Ä¢ Tecnolog√≠as Implementadas: ${results.implemented.length}/${results.totalTechnologies}
‚Ä¢ Cobertura del Portfolio: ${results.coveragePercentage}%
‚Ä¢ Inversi√≥n Total Actual: ${results.totalInvestment.toLocaleString()}
‚Ä¢ Ahorros Anuales Realizados: ${results.annualSavings.toLocaleString()}
‚Ä¢ ROI Actual: ${roi}%
‚Ä¢ Reducci√≥n de Riesgo Lograda: ${results.riskReduction}%

TECNOLOG√çAS IMPLEMENTADAS
-------------------------
${results.implemented.map((tech, idx) => 
    `${idx + 1}. ${tech.name} (Nivel ${tech.maturityLevel}) - ${tech.category}`
).join('\n')}

ROADMAP RECOMENDADO - PR√ìXIMOS PASOS
------------------------------------
${results.recommended.length > 0 ? 
    results.recommended.map((tech, idx) => 
        `${idx + 1}. ${tech.name} (Nivel ${tech.maturityLevel}) - ${tech.category}\n   ‚Ä¢ Inversi√≥n: ${tech.cost.toLocaleString()}\n   ‚Ä¢ ROI Proyectado: ${Math.round(((tech.annualSavings - tech.cost) / tech.cost) * 100)}%\n   ‚Ä¢ Tiempo de Implementaci√≥n: ${tech.implementationTime}`
    ).join('\n\n') : 
    'Felicidades: Ha alcanzado el m√°ximo nivel de madurez'
}

AN√ÅLISIS CONTEXTUAL PARA ${results.companyData.name.toUpperCase()}
${'-'.repeat(50)}
${results.analysis.reasoning}

PR√ìXIMOS PASOS ESTRAT√âGICOS
---------------------------
${results.analysis.nextSteps.map((step, idx) => `${idx + 1}. ${step}`).join('\n')}

RECOMENDACIONES ESTRAT√âGICAS
----------------------------
‚Ä¢ Nivel Objetivo: ${Math.min(5, Math.floor(results.maturityLevel) + 1)}/5.0
‚Ä¢ Priorizar implementaci√≥n de tecnolog√≠as de Nivel ${Math.floor(results.maturityLevel) + 1}
‚Ä¢ Enfoque en automatizaci√≥n y respuesta inteligente
‚Ä¢ Integraci√≥n con frameworks ${results.industryData.frameworks.join(', ')}

Este reporte fue generado autom√°ticamente por Fortinet Security Fabric Maturity Assessment.
Para m√°s informaci√≥n, contacte a su representante de Fortinet.
`;

            const blob = new Blob([reportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const tempLink = document.createElement('a');
            tempLink.href = url;
            tempLink.download = `Fortinet-Maturity-Report-${new Date().toISOString().split('T')[0]}.txt`;
            
            document.body.appendChild(tempLink);
            tempLink.click();
            document.body.removeChild(tempLink);
            URL.revokeObjectURL(url);
            
            console.log('‚úÖ Reporte ejecutivo generado');
            alert('üìÑ ¬°Reporte ejecutivo exportado exitosamente!');
        }

        function scheduleDemo() {
            console.log('üìÖ Redirigiendo a scheduling...');
            const message = `Hola! Me interesa agendar una demo de Fortinet Security Fabric.

Informaci√≥n de mi assessment:
‚Ä¢ Industria: ${results ? results.industryData.name : 'No especificada'}
‚Ä¢ Tama√±o: ${results ? results.companyData.name : 'No especificado'}
‚Ä¢ Nivel de Madurez Actual: ${results ? results.maturityLevel : 'N/A'}/5.0
‚Ä¢ Tecnolog√≠as Implementadas: ${results ? results.implemented.length : 0}

¬øPodr√≠an contactarme para agendar una demostraci√≥n personalizada?`;

            const encodedMessage = encodeURIComponent(message);
            
            if (confirm('¬øQuieres que un especialista de Fortinet te contacte para agendar una demo personalizada?')) {
                alert('‚úÖ ¬°Perfecto! Un especialista de Fortinet se contactar√° contigo en las pr√≥ximas 24 horas para agendar tu demo personalizada.');
                window.open(`https://wa.me/528110044275?text=${encodedMessage}`, '_blank');
            }
        }

        // ============ INITIALIZATION ============
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM Content Loaded - Inicializando Fortinet Maturity Roadmap...');
            
            try {
                const criticalElements = ['homepage', 'step1', 'step1_5', 'step2', 'step3'];
                criticalElements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        console.log(`‚úÖ Secci√≥n encontrada: ${id}`);
                    } else {
                        console.error(`‚ùå Secci√≥n faltante: ${id}`);
                    }
                });
                
                goToStep(0);
                
                console.log('üéâ Fortinet Maturity Roadmap inicializado correctamente');
                console.log(`üìä ${Object.keys(technologies).length} tecnolog√≠as cargadas con posiciones fijas`);
                console.log(`üè¢ ${Object.keys(companySizes).length} tama√±os de empresa configurados`);
                console.log(`üè≠ ${Object.keys(industries).length} industrias disponibles`);
                
                setTimeout(() => {
                    console.log(`‚è∞ Sistema funcionando correctamente. Roadmap sin "baile" listo.`);
                }, 2000);
                
            } catch (error) {
                console.error(`‚ùå Error durante inicializaci√≥n: ${error.message}`);
            }
        });

        console.log('üöÄ Fortinet Maturity Roadmap CORREGIDO cargado completamente - Sin baile de iconos');
    </script>
</body>
</html>
