<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fortinet Security Fabric - Cybersecurity Assessment</title>
    <meta name="description" content="Evaluate su postura de seguridad actual y descubra el roadmap personalizado para alcanzar la excelencia en ciberseguridad con Fortinet">
    <meta name="keywords" content="fortinet, cybersecurity, security assessment, firewall, compliance, roadmap">
    
    <!-- Open Graph para compartir en redes sociales -->
    <meta property="og:title" content="Fortinet Security Assessment">
    <meta property="og:description" content="Cybersecurity Maturity Assessment - Fortinet Security Fabric">
    <meta property="og:type" content="website">
    
    <!-- Favicon simple que no cause errores -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüõ°Ô∏è%3C/text%3E%3C/svg%3E">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #f1f5f9 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .logo-box {
            background: linear-gradient(135deg, #E31E24 0%, #B71C1C 100%);
            border-radius: 15px;
            padding: 12px 20px;
            margin-right: 20px;
            box-shadow: 0 8px 25px rgba(227, 30, 36, 0.3);
        }

        .logo-icon {
            font-size: 32px;
            color: white;
            font-weight: bold;
        }

        .main-title {
            font-size: 36px;
            font-weight: bold;
            color: #1f2937;
            margin: 0;
            line-height: 1.2;
        }

        .subtitle {
            font-size: 18px;
            color: #E31E24;
            font-weight: 600;
            margin-top: 5px;
        }

        .description {
            font-size: 16px;
            color: #6b7280;
            max-width: 600px;
            margin: 0 auto;
        }

        .btn {
            padding: 15px 35px;
            border-radius: 12px;
            border: none;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 8px 8px 0;
            transition: all 0.3s ease;
            display: inline-block;
            text-decoration: none;
            text-align: center;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #E31E24 0%, #B71C1C 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(227, 30, 36, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #333333 0%, #1a1a1a 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(51, 51, 51, 0.3);
        }

        .btn-gray {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
        }

        .trust-indicators {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .trust-item {
            display: flex;
            align-items: center;
            color: #6b7280;
            font-size: 14px;
        }

        .trust-icon {
            color: #E31E24;
            margin-right: 8px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .card-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 30px;
            text-align: center;
        }

        .grid {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .industry-card {
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 15px;
            cursor: pointer;
            background: white;
            transition: all 0.3s ease;
            text-align: center;
        }

        .industry-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .industry-card.selected {
            border: 3px solid #E31E24;
            background: #fef2f2;
        }

        .industry-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .industry-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .industry-frameworks {
            font-size: 12px;
            color: #6b7280;
        }

        .tech-card {
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 15px;
            cursor: pointer;
            background: white;
            transition: all 0.3s ease;
            position: relative;
        }

        .tech-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .tech-card.implemented {
            border: 3px solid #10b981;
            background: #f0fdf4;
        }

        .tech-card.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            border: 3px solid #d1d5db;
            background: #f9fafb;
        }

        .tech-category {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #3b82f6;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
        }

        .tech-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .tech-info {
            display: flex;
            align-items: center;
        }

        .tech-icon {
            font-size: 24px;
            margin-right: 10px;
        }

        .tech-name {
            font-weight: bold;
            font-size: 16px;
        }

        .tech-status {
            color: #10b981;
            font-size: 20px;
        }

        .tech-desc {
            font-size: 14px;
            color: #6b7280;
            margin: 8px 0;
        }

        .dependencies {
            margin: 10px 0;
        }

        .dep-label {
            font-size: 11px;
            font-weight: bold;
            color: #6b7280;
            margin-bottom: 5px;
        }

        .dep-list {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .dep-item {
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 9px;
            font-weight: bold;
        }

        .dep-item.satisfied {
            background: #dcfce7;
            color: #16a34a;
        }

        .dep-item.missing {
            background: #fef2f2;
            color: #dc2626;
        }

        .tech-impact {
            margin-top: 10px;
            font-size: 12px;
            font-weight: bold;
            color: #3b82f6;
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .filter-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid #e5e7eb;
            background: white;
            color: #6b7280;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            border: 2px solid #E31E24;
            background: #fef2f2;
            color: #E31E24;
        }

        .button-group {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            text-align: center;
            padding: 30px;
            border-radius: 15px;
        }

        .metric-value {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .metric-label {
            font-size: 14px;
            color: #6b7280;
        }

        .roadmap-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 15px;
            padding: 20px;
            overflow: auto;
            width: 100%;
        }

        .roadmap-canvas {
            max-width: 100%;
            width: 100%;
            height: auto;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            cursor: grab;
        }

        .roadmap-canvas:active {
            cursor: grabbing;
        }

        .canvas-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            color: #374151;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            border-color: #E31E24;
            color: #E31E24;
        }

        .hidden {
            display: none;
        }

        .phase-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .phase-card {
            padding: 15px;
            border-radius: 12px;
            border: 3px solid;
        }

        .phase-card.current {
            opacity: 1;
        }

        .phase-card.inactive {
            opacity: 0.7;
        }

        .phase-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .phase-number {
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            margin-right: 8px;
            color: white;
        }

        .phase-name {
            font-weight: bold;
            font-size: 14px;
        }

        .phase-desc {
            font-size: 11px;
            color: #6b7280;
        }

        .current-marker {
            margin-left: auto;
            font-size: 16px;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #6b7280;
        }

        /* ROI Cards Styles */
        .roi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .roi-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .roi-card:hover {
            border-color: #E31E24;
            transform: translateY(-3px);
        }

        .roi-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .roi-icon {
            font-size: 28px;
            margin-right: 12px;
        }

        .roi-title {
            font-size: 18px;
            font-weight: bold;
            color: #1f2937;
        }

        .roi-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .roi-subtitle {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 15px;
        }

        .roi-breakdown {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .roi-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .roi-item:last-child {
            border-bottom: none;
        }

        .roi-item-label {
            font-size: 12px;
            color: #6b7280;
        }

        .roi-item-value {
            font-size: 12px;
            font-weight: bold;
            color: #1f2937;
        }

        .executive-summary {
            background: linear-gradient(135deg, #E31E24 0%, #B71C1C 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 15px 35px rgba(227, 30, 36, 0.3);
        }

        .executive-summary h3 {
            font-size: 24px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .executive-summary .summary-icon {
            font-size: 28px;
            margin-right: 12px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .summary-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .summary-label {
            font-size: 12px;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .logo-container {
                flex-direction: column;
                text-align: center;
            }

            .logo-box {
                margin-right: 0;
                margin-bottom: 15px;
            }

            .main-title {
                font-size: 24px;
            }

            .subtitle {
                font-size: 16px;
            }

            .description {
                font-size: 14px;
                padding: 0 10px;
            }

            .btn {
                width: 100%;
                margin: 5px 0;
                padding: 12px 20px;
                font-size: 16px;
            }

            .trust-indicators {
                flex-direction: column;
                gap: 15px;
            }

            .trust-item {
                justify-content: center;
            }

            .button-group {
                justify-content: center;
                flex-direction: column;
            }

            .card {
                padding: 20px;
                margin-bottom: 20px;
            }

            .card-title {
                font-size: 24px;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }

            .grid-3 {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .metric-card {
                padding: 20px;
            }

            .metric-value {
                font-size: 36px;
            }

            .metric-label {
                font-size: 12px;
            }

            .phase-grid {
                grid-template-columns: 1fr;
            }

            .canvas-controls {
                flex-direction: column;
                gap: 8px;
            }

            .control-btn {
                width: 100%;
                padding: 10px 16px;
            }

            .roadmap-container {
                padding: 10px;
                overflow-x: auto;
            }

            .roadmap-canvas {
                min-width: 800px;
                height: 400px;
            }

            .filter-buttons {
                flex-direction: column;
                align-items: center;
            }

            .filter-btn {
                width: 100%;
                max-width: 200px;
                margin: 2px 0;
            }

            .tech-card {
                padding: 15px;
            }

            .tech-icon {
                font-size: 20px;
            }

            .tech-name {
                font-size: 14px;
            }

            .tech-desc {
                font-size: 12px;
            }

            .industry-card {
                padding: 15px;
            }

            .industry-icon {
                font-size: 32px;
            }

            .industry-name {
                font-size: 16px;
            }

            .industry-frameworks {
                font-size: 11px;
            }

            .roi-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .roi-card {
                padding: 20px;
            }

            .roi-value {
                font-size: 24px;
            }

            .executive-summary {
                padding: 20px;
            }

            .executive-summary h3 {
                font-size: 20px;
            }

            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .summary-value {
                font-size: 20px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }

            .main-title {
                font-size: 20px;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .metric-value {
                font-size: 28px;
            }

            .btn {
                padding: 10px 15px;
                font-size: 14px;
            }

            .card {
                padding: 15px;
                border-radius: 15px;
            }

            .card-title {
                font-size: 20px;
                margin-bottom: 20px;
            }

            .roadmap-canvas {
                min-width: 600px;
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo-container">
                <div class="logo-box">
                    <span class="logo-icon">üõ°Ô∏è</span>
                </div>
                <div>
                    <h1 class="main-title">Fortinet Security Fabric</h1>
                    <div class="subtitle">Cybersecurity Maturity Assessment</div>
                </div>
            </div>
            <p class="description">
                Evaluate su postura de seguridad actual y descubra el roadmap personalizado para alcanzar la excelencia en ciberseguridad
            </p>
        </div>

        <!-- Homepage -->
        <div id="homepage" class="card">
            <div style="text-align: center; margin: 30px 0;">
                <button class="btn btn-primary" id="start-btn">
                    üìä Iniciar Assessment
                </button>
            </div>
            
            <div class="trust-indicators">
                <div class="trust-item">
                    <span class="trust-icon">üèÜ</span>
                    #1 en Firewalls Globalmente
                </div>
                <div class="trust-item">
                    <span class="trust-icon">üõ°Ô∏è</span>
                    500,000+ Organizaciones
                </div>
                <div class="trust-item">
                    <span class="trust-icon">‚ö°</span>
                    Assessment en 5 Minutos
                </div>
            </div>
        </div>

        <!-- Step 1: Industry Selection -->
        <div id="step1" class="card hidden">
            <h2 class="card-title">üè¢ Selecciona tu Industria</h2>
            
            <div class="grid grid-2" id="industries-grid">
                <!-- Se llena din√°micamente -->
            </div>

            <div style="text-align: center;">
                <button class="btn btn-primary" id="continue-btn" disabled>
                    Continuar al Assessment ‚Üí
                </button>
            </div>
        </div>

        <!-- Step 2: Technology Assessment -->
        <div id="step2" class="card hidden">
            <h2 class="card-title">üîç Assessment del Portafolio Fortinet</h2>

            <!-- Category Filters -->
            <div class="filter-buttons" id="category-filters">
                <!-- Se llena din√°micamente -->
            </div>
            
            <div class="grid grid-3" id="technologies-grid">
                <!-- Se llena din√°micamente -->
            </div>

            <div class="button-group">
                <button class="btn btn-gray" id="back-btn">
                    ‚Üê Anterior
                </button>
                <button class="btn btn-primary" id="generate-btn">
                    üöÄ Generar Roadmap
                </button>
            </div>
        </div>

        <!-- Step 4: Results -->
        <div id="step4" class="hidden">
            <!-- Overview -->
            <div class="card">
                <h2 class="card-title">üéØ Tu Nivel de Madurez</h2>
                
                <div class="metrics-grid" id="metrics-grid">
                    <!-- Se llena din√°micamente -->
                </div>
            </div>

            <!-- Roadmap Visual -->
            <div class="card">
                <h2 class="card-title">üó∫Ô∏è Roadmap Visual de Madurez en Ciberseguridad</h2>
                
                <!-- Canvas Controls -->
                <div class="canvas-controls">
                    <button class="control-btn" onclick="zoomCanvas(1.2)">üîç+ Zoom In</button>
                    <button class="control-btn" onclick="zoomCanvas(0.8)">üîç- Zoom Out</button>
                    <button class="control-btn" onclick="resetCanvas()">üîÑ Reset View</button>
                    <button class="control-btn" onclick="toggleFullscreen()">üì∫ Pantalla Completa</button>
                </div>
                
                <div class="roadmap-container" id="roadmap-container">
                    <canvas id="roadmap-canvas" width="2000" height="1200" class="roadmap-canvas"></canvas>
                </div>

                <!-- Phase Details -->
                <div class="phase-grid" id="phases-grid">
                    <!-- Se llena din√°micamente -->
                </div>
            </div>

            <!-- Technologies -->
            <div class="grid grid-2">
                <!-- Implemented -->
                <div class="card">
                    <h3 style="font-size: 24px; font-weight: bold; margin-bottom: 20px; color: #10b981;">
                        ‚úÖ Implementadas (<span id="implemented-count">0</span>)
                    </h3>
                    
                    <div id="implemented-list">
                        <!-- Se llena din√°micamente -->
                    </div>
                </div>

                <!-- Missing -->
                <div class="card">
                    <h3 style="font-size: 24px; font-weight: bold; margin-bottom: 20px; color: #E31E24;">
                        üéØ Pr√≥ximos Pasos (<span id="missing-count">0</span>)
                    </h3>
                    
                    <div id="missing-list">
                        <!-- Se llena din√°micamente -->
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-top: 30px;">
                <button class="btn btn-gray" id="reset-btn">
                    üîÑ Nuevo Assessment
                </button>
                <button class="btn btn-primary" id="export-btn">
                    üñºÔ∏è Descargar Roadmap
                </button>
                <button class="btn btn-secondary" id="report-btn">
                    üìÑ Generar Reporte
                </button>
                <button class="btn btn-primary" id="share-btn">
                    üîó Compartir Resultado
                </button>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>¬© 2025 Fortinet Security Fabric - Cybersecurity Assessment Tool</p>
            <p style="font-size: 14px;">Para m√°s informaci√≥n contacte a su representante Fortinet</p>
        </div>
    </div>

    <script>
        // Data structures
        const industries = {
            financial: { name: 'Servicios Financieros', icon: 'üè¶', frameworks: ['SOX', 'PCI-DSS', 'NIST', 'ISO27001'] },
            government: { name: 'Gobierno', icon: 'üèõÔ∏è', frameworks: ['NIST', 'FedRAMP', 'FISMA', 'CIS'] },
            healthcare: { name: 'Salud', icon: 'üè•', frameworks: ['HIPAA', 'HITECH', 'NIST', 'ISO27001'] },
            retail: { name: 'Retail', icon: 'üõí', frameworks: ['PCI-DSS', 'GDPR', 'ISO27001', 'CIS'] },
            manufacturing: { name: 'Manufactura', icon: 'üè≠', frameworks: ['IEC62443', 'NIST', 'ISO27001', 'CIS'] },
            education: { name: 'Educaci√≥n', icon: 'üéì', frameworks: ['FERPA', 'NIST', 'ISO27001', 'CIS'] }
        };

        const maturityPhases = {
            phase1: { name: "B√°sico - Protecci√≥n Fundamental", level: "1.0 - 2.5", color: "#dc2626", bgColor: "#fee2e2", description: "Controles b√°sicos de seguridad", compliance: 25 },
            phase2: { name: "Intermedio - Detecci√≥n y Respuesta", level: "2.5 - 3.5", color: "#f97316", bgColor: "#fed7aa", description: "Capacidades de detecci√≥n y an√°lisis", compliance: 60 },
            phase3: { name: "Avanzado - Orquestaci√≥n Inteligente", level: "3.5 - 4.5", color: "#0891b2", bgColor: "#cffafe", description: "Respuesta automatizada y XDR", compliance: 85 },
            phase4: { name: "Excelencia - Zero Trust & AI", level: "4.5 - 5.0", color: "#059669", bgColor: "#dcfce7", description: "Arquitectura Zero Trust completa", compliance: 100 }
        };

        const technologies = {
            'FortiGate 30G': { 
                icon: 'üî•', 
                score: 0.8, 
                desc: 'Next-Generation Firewall de entrada', 
                phase: 'phase1', 
                category: 'Network Security', 
                dependencies: [], 
                enables: ['FortiAnalyzer', 'FortiManager'],
                cost: 15000,
                annualSavings: 75000,
                implementationTime: '2-4 semanas',
                riskReduction: 25
            },
            'FortiGate 700G': { 
                icon: '‚ö°', 
                score: 1.8, 
                desc: 'Hybrid Mesh Firewall avanzado', 
                phase: 'phase3', 
                category: 'Network Security', 
                dependencies: [], 
                enables: ['FortiAnalyzer', 'FortiXDR'],
                cost: 45000,
                annualSavings: 180000,
                implementationTime: '4-6 semanas',
                riskReduction: 35
            },
            'FortiEDR': { 
                icon: 'üõ°Ô∏è', 
                score: 1.3, 
                desc: 'Endpoint Detection and Response', 
                phase: 'phase2', 
                category: 'Endpoint Security', 
                dependencies: ['FortiClient EMS'], 
                enables: ['FortiXDR'],
                cost: 25000,
                annualSavings: 120000,
                implementationTime: '3-5 semanas',
                riskReduction: 30
            },
            'FortiXDR': { 
                icon: 'üéØ', 
                score: 1.7, 
                desc: 'Extended Detection and Response', 
                phase: 'phase3', 
                category: 'SOC & Analytics', 
                dependencies: ['FortiEDR'], 
                enables: ['FortiSIEM'],
                cost: 35000,
                annualSavings: 200000,
                implementationTime: '6-8 semanas',
                riskReduction: 40
            },
            'FortiSIEM': { 
                icon: 'üîç', 
                score: 1.4, 
                desc: 'Security Information and Event Management', 
                phase: 'phase3', 
                category: 'SOC & Analytics', 
                dependencies: ['FortiAnalyzer'], 
                enables: ['FortiSOAR'],
                cost: 40000,
                annualSavings: 160000,
                implementationTime: '8-12 semanas',
                riskReduction: 35
            },
            'FortiAnalyzer': { 
                icon: 'üìä', 
                score: 0.9, 
                desc: 'Security Analytics y Reporting', 
                phase: 'phase2', 
                category: 'SOC & Analytics', 
                dependencies: ['FortiGate 30G'], 
                enables: ['FortiSIEM'],
                cost: 20000,
                annualSavings: 85000,
                implementationTime: '2-3 semanas',
                riskReduction: 20
            },
            'FortiAuthenticator': { 
                icon: 'üîê', 
                score: 0.8, 
                desc: 'Multi-Factor Authentication', 
                phase: 'phase1', 
                category: 'Access Control', 
                dependencies: [], 
                enables: ['FortiNAC'],
                cost: 12000,
                annualSavings: 65000,
                implementationTime: '1-2 semanas',
                riskReduction: 25
            },
            'FortiNAC': { 
                icon: 'üö™', 
                score: 1.2, 
                desc: 'Network Access Control', 
                phase: 'phase2', 
                category: 'Access Control', 
                dependencies: ['FortiAuthenticator'], 
                enables: [],
                cost: 18000,
                annualSavings: 90000,
                implementationTime: '3-4 semanas',
                riskReduction: 30
            },
            'FortiMail': { 
                icon: 'üìß', 
                score: 1.0, 
                desc: 'Email Security Gateway', 
                phase: 'phase1', 
                category: 'Email & Web Security', 
                dependencies: [], 
                enables: ['FortiSandbox'],
                cost: 16000,
                annualSavings: 95000,
                implementationTime: '2-3 semanas',
                riskReduction: 35
            },
            'FortiWeb': { 
                icon: 'üåç', 
                score: 1.1, 
                desc: 'Web Application Firewall', 
                phase: 'phase2', 
                category: 'Email & Web Security', 
                dependencies: [], 
                enables: ['FortiSandbox'],
                cost: 22000,
                annualSavings: 110000,
                implementationTime: '3-4 semanas',
                riskReduction: 28
            },
            'FortiSandbox': { 
                icon: 'üß™', 
                score: 1.0, 
                desc: 'Advanced Threat Protection', 
                phase: 'phase2', 
                category: 'Email & Web Security', 
                dependencies: ['FortiMail'], 
                enables: ['FortiXDR'],
                cost: 28000,
                annualSavings: 140000,
                implementationTime: '4-5 semanas',
                riskReduction: 32
            },
            'FortiClient EMS': { 
                icon: 'üíª', 
                score: 0.7, 
                desc: 'Endpoint Management Suite', 
                phase: 'phase1', 
                category: 'Endpoint Security', 
                dependencies: [], 
                enables: ['FortiEDR'],
                cost: 10000,
                annualSavings: 50000,
                implementationTime: '1-2 semanas',
                riskReduction: 15
            },
            'FortiSwitch': { 
                icon: 'üîå', 
                score: 0.6, 
                desc: 'Switching Ethernet seguro', 
                phase: 'phase2', 
                category: 'Secure Networking', 
                dependencies: ['FortiGate 30G'], 
                enables: ['FortiNAC'],
                cost: 14000,
                annualSavings: 60000,
                implementationTime: '2-3 semanas',
                riskReduction: 20
            },
            'FortiAP': { 
                icon: 'üì∂', 
                score: 0.5, 
                desc: 'Wireless Access Points', 
                phase: 'phase2', 
                category: 'Secure Networking', 
                dependencies: ['FortiGate 30G'], 
                enables: ['FortiNAC'],
                cost: 12000,
                annualSavings: 45000,
                implementationTime: '2-3 semanas',
                riskReduction: 18
            },
            'FortiSASE': { 
                icon: 'üåê', 
                score: 1.8, 
                desc: 'Secure Access Service Edge', 
                phase: 'phase4', 
                category: 'SASE & SD-WAN', 
                dependencies: ['FortiGate 700G'], 
                enables: [],
                cost: 60000,
                annualSavings: 250000,
                implementationTime: '12-16 semanas',
                riskReduction: 45
            },
            'FortiManager': { 
                icon: '‚öôÔ∏è', 
                score: 0.8, 
                desc: 'Centralized Security Management', 
                phase: 'phase2', 
                category: 'Management', 
                dependencies: ['FortiGate 30G'], 
                enables: [],
                cost: 15000,
                annualSavings: 70000,
                implementationTime: '2-4 semanas',
                riskReduction: 15
            },
            'FortiSOAR': { 
                icon: 'ü§ñ', 
                score: 1.3, 
                desc: 'Security Orchestration and Response', 
                phase: 'phase3', 
                category: 'SOC & Analytics', 
                dependencies: ['FortiSIEM'], 
                enables: [],
                cost: 50000,
                annualSavings: 220000,
                implementationTime: '8-12 semanas',
                riskReduction: 38
            },
            'FortiCWP': { 
                icon: '‚òÅÔ∏è', 
                score: 1.1, 
                desc: 'Cloud Workload Protection', 
                phase: 'phase3', 
                category: 'Cloud Security', 
                dependencies: [], 
                enables: ['FortiXDR'],
                cost: 30000,
                annualSavings: 150000,
                implementationTime: '4-6 semanas',
                riskReduction: 33
            }
        };

        // App state
        let currentStep = 0;
        let assessmentData = {
            industry: '',
            frameworks: [],
            techs: {},
            categoryFilter: 'Todas'
        };
        let results = null;

        // Canvas control variables
        let canvasScale = 1;
        let canvasOffsetX = 0;
        let canvasOffsetY = 0;
        let isDragging = false;
        let lastMouseX = 0;
        let lastMouseY = 0;

        // Helper functions
        function show(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.classList.remove('hidden');
            }
        }

        function hide(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.classList.add('hidden');
            }
        }

        function goToStep(step) {
            hide('homepage');
            hide('step1');
            hide('step2');
            hide('step4');
            
            currentStep = step;
            if (step === 0) show('homepage');
            else if (step === 1) show('step1');
            else if (step === 2) show('step2');
            else if (step === 4) show('step4');
        }

        // Navigation functions
        function startAssessment() {
            renderIndustries();
            goToStep(1);
        }

        function continueToAssessment() {
            if (!assessmentData.industry) return;
            renderTechnologies();
            goToStep(2);
        }

        function resetAssessment() {
            assessmentData = { industry: '', frameworks: [], techs: {}, categoryFilter: 'Todas' };
            results = null;
            currentStep = 0;
            goToStep(0);
        }

        // Industry selection
        function renderIndustries() {
            const grid = document.getElementById('industries-grid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            Object.entries(industries).forEach(([key, industry]) => {
                const card = document.createElement('div');
                card.className = `industry-card ${assessmentData.industry === key ? 'selected' : ''}`;
                card.onclick = () => selectIndustry(key);
                
                card.innerHTML = `
                    <div class="industry-icon">${industry.icon}</div>
                    <div class="industry-name">${industry.name}</div>
                    <div class="industry-frameworks">Frameworks: ${industry.frameworks.join(', ')}</div>
                `;
                
                grid.appendChild(card);
            });
        }

        function selectIndustry(industryKey) {
            assessmentData.industry = industryKey;
            assessmentData.frameworks = industries[industryKey].frameworks;
            
            document.querySelectorAll('.industry-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.industry-card').classList.add('selected');
            
            const continueBtn = document.getElementById('continue-btn');
            continueBtn.disabled = false;
            continueBtn.style.background = 'linear-gradient(135deg, #E31E24 0%, #B71C1C 100%)';
            continueBtn.style.boxShadow = '0 8px 25px rgba(227, 30, 36, 0.3)';
        }

        // Technology assessment
        function renderTechnologies() {
            renderCategoryFilters();
            renderTechGrid();
        }

        function renderCategoryFilters() {
            const container = document.getElementById('category-filters');
            const categories = ['Todas', 'Network Security', 'Endpoint Security', 'Email & Web Security', 'Access Control', 'SOC & Analytics', 'Cloud Security', 'SASE & SD-WAN', 'Management'];
            
            container.innerHTML = '';
            categories.forEach(category => {
                const btn = document.createElement('button');
                btn.className = `filter-btn ${assessmentData.categoryFilter === category ? 'active' : ''}`;
                btn.textContent = category;
                btn.onclick = () => {
                    assessmentData.categoryFilter = category;
                    renderCategoryFilters();
                    renderTechGrid();
                };
                container.appendChild(btn);
            });
        }

        function renderTechGrid() {
            const grid = document.getElementById('technologies-grid');
            grid.innerHTML = '';
            
            Object.entries(technologies)
                .filter(([name, tech]) => 
                    assessmentData.categoryFilter === 'Todas' || 
                    tech.category === assessmentData.categoryFilter
                )
                .forEach(([name, tech]) => {
                    const isImplemented = assessmentData.techs[name];
                    const hasImplementedDependencies = tech.dependencies.every(dep => assessmentData.techs[dep]);
                    const canImplement = tech.dependencies.length === 0 || hasImplementedDependencies;
                    
                    const card = document.createElement('div');
                    card.className = `tech-card ${isImplemented ? 'implemented' : ''} ${!canImplement && !isImplemented ? 'disabled' : ''}`;
                    
                    if (canImplement || isImplemented) {
                        card.onclick = () => toggleTechnology(name);
                    }
                    
                    let dependenciesHTML = '';
                    if (tech.dependencies.length > 0) {
                        const depItems = tech.dependencies.map(dep => 
                            `<span class="dep-item ${assessmentData.techs[dep] ? 'satisfied' : 'missing'}">
                                ${assessmentData.techs[dep] ? '‚úì' : '‚óã'} ${dep.split(' ')[0]}
                            </span>`
                        ).join('');
                        
                        dependenciesHTML = `
                            <div class="dependencies">
                                <div class="dep-label">Requiere:</div>
                                <div class="dep-list">${depItems}</div>
                            </div>
                        `;
                    }
                    
                    card.innerHTML = `
                        <div class="tech-category">${tech.category}</div>
                        <div class="tech-header">
                            <div class="tech-info">
                                <span class="tech-icon">${tech.icon}</span>
                                <span class="tech-name">${name}</span>
                            </div>
                            ${isImplemented ? '<span class="tech-status">‚úÖ</span>' : ''}
                            ${!canImplement && !isImplemented ? '<span style="color: #9ca3af; font-size: 16px;">üîí</span>' : ''}
                        </div>
                        <p class="tech-desc">${tech.desc}</p>
                        ${dependenciesHTML}
                        <div class="tech-impact">Impacto: +${tech.score}</div>
                        <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 11px; color: #6b7280;">
                            <span>üí∞ $${tech.cost.toLocaleString()}</span>
                            <span>üìà $${tech.annualSavings.toLocaleString()}/a√±o</span>
                        </div>
                        <div style="font-size: 11px; color: #3b82f6; margin-top: 5px;">
                            ‚è±Ô∏è ${tech.implementationTime} | üõ°Ô∏è -${tech.riskReduction}% riesgo
                        </div>
                    `;
                    
                    grid.appendChild(card);
                });
        }

        function toggleTechnology(name) {
            assessmentData.techs[name] = !assessmentData.techs[name];
            renderTechGrid();
        }

        // Results generation
        function generateResults() {
            try {
                const implemented = Object.entries(assessmentData.techs)
                    .filter(([_, selected]) => selected)
                    .map(([name, _]) => ({ name, ...technologies[name] }));
                
                const missing = Object.entries(technologies)
                    .filter(([name, _]) => !assessmentData.techs[name])
                    .map(([name, tech]) => ({ name, ...tech }))
                    .sort((a, b) => b.score - a.score);

                const overallMaturity = calculateMaturityLevel();
                const currentPhase = getCurrentPhase();

                results = {
                    implemented,
                    missing,
                    overallMaturity: Math.round(overallMaturity * 10) / 10,
                    currentPhase,
                    riskReduction: Math.min(overallMaturity * 17, 85)
                };
                
                if (!results.implemented || !results.missing) {
                    throw new Error('Datos de resultados inv√°lidos');
                }
                
                renderResults();
                goToStep(4);
                
            } catch (error) {
                alert('Error al generar resultados. Por favor selecciona al menos una tecnolog√≠a e intenta de nuevo.');
            }
        }

        function calculateMaturityLevel() {
            const implemented = Object.entries(assessmentData.techs).filter(([_, selected]) => selected).map(([name, _]) => technologies[name]);
            const totalScore = implemented.reduce((sum, tech) => sum + tech.score, 0);
            const maxPossibleScore = Object.values(technologies).reduce((sum, tech) => sum + tech.score, 0);
            return Math.min(5, Math.max(1, (totalScore / maxPossibleScore) * 5));
        }

        function getCurrentPhase() {
            const level = calculateMaturityLevel();
            if (level <= 2.5) return 'phase1';
            if (level <= 3.5) return 'phase2'; 
            if (level <= 4.5) return 'phase3';
            return 'phase4';
        }

        function renderResults() {
            try {
                renderMetrics();
                renderPhases();
                renderImplementedList();
                renderMissingList();
                
                setTimeout(() => {
                    renderROIDashboard();
                }, 100);
                
                setTimeout(() => {
                    drawRoadmapElegante();
                    setupCanvasControls();
                }, 400);
                
            } catch (error) {
                alert('Error al generar el roadmap. Por favor intenta de nuevo.');
            }
        }

        function renderMetrics() {
            const grid = document.getElementById('metrics-grid');
            grid.innerHTML = `
                <div class="metric-card" style="background: #dbeafe;">
                    <div class="metric-value" style="color: #3b82f6;">${results.overallMaturity}</div>
                    <div class="metric-label">Nivel Actual</div>
                </div>
                <div class="metric-card" style="background: #dcfce7;">
                    <div class="metric-value" style="color: #10b981;">${results.implemented.length}</div>
                    <div class="metric-label">Implementadas</div>
                </div>
                <div class="metric-card" style="background: #fef3c7;">
                    <div class="metric-value" style="color: #f59e0b;">${assessmentData.frameworks.length}</div>
                    <div class="metric-label">Frameworks</div>
                </div>
                <div class="metric-card" style="background: #fdf4ff;">
                    <div class="metric-value" style="color: #a855f7;">${maturityPhases[results.currentPhase]?.name.split(' - ')[0] || 'B√°sico'}</div>
                    <div class="metric-label">Fase Actual</div>
                </div>
            `;
        }

        function renderPhases() {
            const grid = document.getElementById('phases-grid');
            grid.innerHTML = '';
            
            Object.entries(maturityPhases).forEach(([phaseKey, phase], index) => {
                const isCurrentPhase = results.currentPhase === phaseKey;
                const card = document.createElement('div');
                card.className = `phase-card ${isCurrentPhase ? 'current' : 'inactive'}`;
                card.style.borderColor = phase.color;
                card.style.background = isCurrentPhase ? phase.bgColor : 'white';
                
                card.innerHTML = `
                    <div class="phase-header">
                        <span class="phase-number" style="background: ${phase.color};">${index + 1}</span>
                        <span class="phase-name" style="color: ${phase.color};">${phase.name.split(' - ')[0]}</span>
                        ${isCurrentPhase ? '<span class="current-marker">üìç</span>' : ''}
                    </div>
                    <div class="phase-desc">${phase.description}</div>
                `;
                
                grid.appendChild(card);
            });
        }

        function renderImplementedList() {
            const container = document.getElementById('implemented-list');
            const count = document.getElementById('implemented-count');
            
            count.textContent = results.implemented.length;
            
            if (results.implemented.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #6b7280;">
                        <div style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;">üõ°Ô∏è</div>
                        <p>No tienes tecnolog√≠as Fortinet</p>
                    </div>
                `;
            } else {
                container.innerHTML = results.implemented.map(tech => `
                    <div style="border: 2px solid #10b981; border-radius: 12px; padding: 15px; background: #f0fdf4; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; margin-bottom: 8px;">
                            <span style="font-size: 20px; margin-right: 10px;">${tech.icon}</span>
                            <span style="font-weight: bold;">${tech.name}</span>
                            <span style="margin-left: auto; font-size: 12px; background: #10b981; color: white; padding: 4px 8px; border-radius: 20px;">
                                ROI: ${Math.round(((tech.annualSavings - tech.cost) / tech.cost) * 100)}%
                            </span>
                        </div>
                        <p style="font-size: 14px; color: #6b7280; margin: 8px 0;">${tech.desc}</p>
                        <div style="display: flex; justify-content: space-between; font-size: 12px; color: #059669;">
                            <span>üí∞ Inversi√≥n: $${tech.cost.toLocaleString()}</span>
                            <span>üìà Ahorro anual: $${tech.annualSavings.toLocaleString()}</span>
                        </div>
                        <div style="font-size: 12px; color: #059669; margin-top: 5px;">
                            ‚è±Ô∏è ${tech.implementationTime} | üõ°Ô∏è -${tech.riskReduction}% riesgo
                        </div>
                    </div>
                `).join('');
            }
        }

        function renderMissingList() {
            const container = document.getElementById('missing-list');
            const count = document.getElementById('missing-count');
            
            count.textContent = Math.min(results.missing.length, 5);
            
            container.innerHTML = results.missing.slice(0, 5).map((tech, idx) => `
                <div style="border: 2px solid #E31E24; border-radius: 12px; padding: 15px; background: #fef2f2; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <span style="font-size: 20px; margin-right: 10px;">${tech.icon}</span>
                        <span style="font-weight: bold;">${tech.name}</span>
                        <span style="margin-left: auto; font-size: 12px; background: #E31E24; color: white; padding: 4px 8px; border-radius: 20px;">
                            #${idx + 1} Prioridad
                        </span>
                    </div>
                    <p style="font-size: 14px; color: #6b7280; margin: 8px 0;">${tech.desc}</p>
                    <div style="display: flex; justify-content: space-between; font-size: 12px; color: #dc2626;">
                        <span>üí∞ Inversi√≥n: $${tech.cost.toLocaleString()}</span>
                        <span>üìà Ahorro potencial: $${tech.annualSavings.toLocaleString()}/a√±o</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 12px; color: #dc2626; margin-top: 5px;">
                        <span>‚è±Ô∏è ${tech.implementationTime}</span>
                        <span>ROI proyectado: ${Math.round(((tech.annualSavings - tech.cost) / tech.cost) * 100)}%</span>
                    </div>
                    <div style="font-size: 12px; color: #dc2626; margin-top: 5px;">
                        üõ°Ô∏è Reducir√° riesgo adicional en ${tech.riskReduction}%
                    </div>
                </div>
            `).join('');
        }

        // ROI Analysis functions
        function calculateROIMetrics() {
            const implemented = results.implemented;
            const missing = results.missing;
            
            const totalInvestment = implemented.reduce((sum, tech) => sum + tech.cost, 0);
            const annualSavings = implemented.reduce((sum, tech) => sum + tech.annualSavings, 0);
            const riskReductionValue = implemented.reduce((sum, tech) => sum + (tech.riskReduction * 10000), 0);
            
            const recommendedInvestment = missing.slice(0, 5).reduce((sum, tech) => sum + tech.cost, 0);
            const projectedSavings = missing.slice(0, 5).reduce((sum, tech) => sum + tech.annualSavings, 0);
            
            const totalImplementationTime = implemented.reduce((sum, tech) => sum + parseInt(tech.implementationTime), 0);
            const avgBreachCost = 4500000;
            const breachProbabilityReduction = implemented.reduce((sum, tech) => sum + tech.riskReduction, 0);
            
            const currentROI = totalInvestment > 0 ? ((annualSavings - totalInvestment) / totalInvestment * 100) : 0;
            const paybackPeriod = totalInvestment > 0 ? (totalInvestment / annualSavings * 12) : 0;
            const projectedROI = recommendedInvestment > 0 ? ((projectedSavings - recommendedInvestment) / recommendedInvestment * 100) : 0;
            
            const potentialLossPrevented = (breachProbabilityReduction / 100) * avgBreachCost;
            const complianceScore = Math.min(100, (implemented.length / Object.keys(technologies).length) * 100);
            
            return {
                totalInvestment,
                annualSavings,
                currentROI: Math.round(currentROI),
                paybackPeriod: Math.round(paybackPeriod),
                recommendedInvestment,
                projectedSavings,
                projectedROI: Math.round(projectedROI),
                potentialLossPrevented,
                riskReductionValue,
                breachProbabilityReduction: Math.min(85, breachProbabilityReduction),
                complianceScore: Math.round(complianceScore),
                totalImplementationTime,
                netPresentValue: (annualSavings * 3) - totalInvestment,
                costAvoidance: riskReductionValue + potentialLossPrevented
            };
        }

        function renderROIAnalysis() {
            const roiMetrics = calculateROIMetrics();
            
            return `
                <!-- Executive Summary -->
                <div class="executive-summary">
                    <h3><span class="summary-icon">üìä</span>Resumen Ejecutivo para CISO</h3>
                    <p style="font-size: 16px; margin-bottom: 20px; opacity: 0.95;">
                        An√°lisis financiero de su inversi√≥n actual en Fortinet Security Fabric y proyecciones para maximizar el ROI.
                    </p>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-value">${roiMetrics.currentROI}%</div>
                            <div class="summary-label">ROI Actual</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">${roiMetrics.paybackPeriod}</div>
                            <div class="summary-label">Meses Payback</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">$${(roiMetrics.potentialLossPrevented/1000000).toFixed(1)}M</div>
                            <div class="summary-label">P√©rdidas Evitadas</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">${roiMetrics.complianceScore}%</div>
                            <div class="summary-label">Compliance Score</div>
                        </div>
                    </div>
                </div>

                <!-- ROI Cards Grid -->
                <div class="roi-grid">
                    <!-- Inversi√≥n Actual -->
                    <div class="roi-card">
                        <div class="roi-header">
                            <span class="roi-icon">üí∞</span>
                            <span class="roi-title">Inversi√≥n Actual</span>
                        </div>
                        <div class="roi-value" style="color: #dc2626;">${roiMetrics.totalInvestment.toLocaleString()}</div>
                        <div class="roi-subtitle">Capital invertido en tecnolog√≠as implementadas</div>
                        <div class="roi-breakdown">
                            <div class="roi-item">
                                <span class="roi-item-label">Tecnolog√≠as implementadas</span>
                                <span class="roi-item-value">${results.implemented.length}</span>
                            </div>
                            <div class="roi-item">
                                <span class="roi-item-label">Tiempo de implementaci√≥n</span>
                                <span class="roi-item-value">${roiMetrics.totalImplementationTime} semanas</span>
                            </div>
                            <div class="roi-item">
                                <span class="roi-item-label">Reducci√≥n de riesgo</span>
                                <span class="roi-item-value">${roiMetrics.breachProbabilityReduction}%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Ahorros Anuales -->
                    <div class="roi-card">
                        <div class="roi-header">
                            <span class="roi-icon">üìà</span>
                            <span class="roi-title">Beneficios Anuales</span>
                        </div>
                        <div class="roi-value" style="color: #10b981;">${roiMetrics.annualSavings.toLocaleString()}</div>
                        <div class="roi-subtitle">Ahorros operativos y evitaci√≥n de costos</div>
                        <div class="roi-breakdown">
                            <div class="roi-item">
                                <span class="roi-item-label">Ahorros operativos</span>
                                <span class="roi-item-value">${(roiMetrics.annualSavings * 0.6).toLocaleString()}</span>
                            </div>
                            <div class="roi-item">
                                <span class="roi-item-label">Evitaci√≥n de multas</span>
                                <span class="roi-item-value">${(roiMetrics.annualSavings * 0.25).toLocaleString()}</span>
                            </div>
                            <div class="roi-item">
                                <span class="roi-item-label">Productividad mejorada</span>
                                <span class="roi-item-value">${(roiMetrics.annualSavings * 0.15).toLocaleString()}</span>
                            </div>
                        </div>
                    </div>

                    <!-- ROI y Payback -->
                    <div class="roi-card">
                        <div class="roi-header">
                            <span class="roi-icon">‚è±Ô∏è</span>
                            <span class="roi-title">Retorno de Inversi√≥n</span>
                        </div>
                        <div class="roi-value" style="color: #3b82f6;">${roiMetrics.currentROI}%</div>
                        <div class="roi-subtitle">ROI anualizado de inversi√≥n actual</div>
                        <div class="roi-breakdown">
                            <div class="roi-item">
                                <span class="roi-item-label">Per√≠odo de recuperaci√≥n</span>
                                <span class="roi-item-value">${roiMetrics.paybackPeriod} meses</span>
                            </div>
                            <div class="roi-item">
                                <span class="roi-item-label">NPV (3 a√±os)</span>
                                <span class="roi-item-value">${roiMetrics.netPresentValue.toLocaleString()}</span>
                            </div>
                            <div class="roi-item">
                                <span class="roi-item-label">IRR estimada</span>
                                <span class="roi-item-value">${Math.round(roiMetrics.currentROI * 1.2)}%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Pr√≥ximas Inversiones -->
                    <div class="roi-card">
                        <div class="roi-header">
                            <span class="roi-icon">üéØ</span>
                            <span class="roi-title">Pr√≥ximas Inversiones</span>
                        </div>
                        <div class="roi-value" style="color: #f59e0b;">${roiMetrics.recommendedInvestment.toLocaleString()}</div>
                        <div class="roi-subtitle">Inversi√≥n recomendada para pr√≥ximas 5 tecnolog√≠as</div>
                        <div class="roi-breakdown">
                            <div class="roi-item">
                                <span class="roi-item-label">Ahorros proyectados anuales</span>
                                <span class="roi-item-value">${roiMetrics.projectedSavings.toLocaleString()}</span>
                            </div>
                            <div class="roi-item">
                                <span class="roi-item-label">ROI proyectado</span>
                                <span class="roi-item-value">${roiMetrics.projectedROI}%</span>
                            </div>
                            <div class="roi-item">
                                <span class="roi-item-label">Tecnolog√≠as prioritarias</span>
                                <span class="roi-item-value">${Math.min(5, results.missing.length)}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Risk & Compliance -->
                    <div class="roi-card">
                        <div class="roi-header">
                            <span class="roi-icon">üõ°Ô∏è</span>
                            <span class="roi-title">Reducci√≥n de Riesgo</span>
                        </div>
                        <div class="roi-value" style="color: #8b5cf6;">${(roiMetrics.potentialLossPrevented/1000000).toFixed(1)}M</div>
                        <div class="roi-subtitle">Valor de p√©rdidas potenciales evitadas</div>
                        <div class="roi-breakdown">
                            <div class="roi-item">
                                <span class="roi-item-label">Reducci√≥n prob. de breach</span>
                                <span class="roi-item-value">${roiMetrics.breachProbabilityReduction}%</span>
                            </div>
                            <div class="roi-item">
                                <span class="roi-item-label">Score de compliance</span>
                                <span class="roi-item-value">${roiMetrics.complianceScore}%</span>
                            </div>
                            <div class="roi-item">
                                <span class="roi-item-label">Cobertura de frameworks</span>
                                <span class="roi-item-value">${assessmentData.frameworks.length}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderROIDashboard() {
            const step4Container = document.getElementById('step4');
            if (!step4Container) return;
            
            let existingROICard = step4Container.querySelector('.roi-analysis-card');
            if (existingROICard) {
                existingROICard.remove();
            }
            
            const roiCard = document.createElement('div');
            roiCard.className = 'card roi-analysis-card';
            roiCard.innerHTML = `
                <h2 class="card-title">üíº An√°lisis Financiero y ROI para CISO</h2>
                ${renderROIAnalysis()}
            `;
            
            const firstCard = step4Container.querySelector('.card');
            if (firstCard && firstCard.nextSibling) {
                step4Container.insertBefore(roiCard, firstCard.nextSibling);
            } else if (firstCard) {
                firstCard.parentNode.insertBefore(roiCard, firstCard.nextSibling);
            } else {
                step4Container.prepend(roiCard);
            }
        }

        // Roadmap drawing function
        function drawRoadmapElegante() {
            const canvas = document.getElementById('roadmap-canvas');
            if (!canvas || !results) return;

            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            ctx.clearRect(0, 0, width, height);

            const bgGradient = ctx.createLinearGradient(0, 0, 0, height);
            bgGradient.addColorStop(0, '#f8fafc');
            bgGradient.addColorStop(0.5, '#ffffff');
            bgGradient.addColorStop(1, '#f1f5f9');
            ctx.fillStyle = bgGradient;
            ctx.fillRect(0, 0, width, height);

            const margin = 150;
            const startX = margin;
            const startY = height - margin;
            const endX = width - margin;
            const endY = margin * 2;
            
            const cp1X = width * 0.25;
            const cp1Y = height - margin * 0.7;
            const cp2X = width * 0.75;
            const cp2Y = margin * 2.5;

            const getPointOnCurve = (t) => {
                const x = Math.pow(1-t, 3) * startX + 
                          3 * Math.pow(1-t, 2) * t * cp1X + 
                          3 * (1-t) * Math.pow(t, 2) * cp2X + 
                          Math.pow(t, 3) * endX;
                const y = Math.pow(1-t, 3) * startY + 
                          3 * Math.pow(1-t, 2) * t * cp1Y + 
                          3 * (1-t) * Math.pow(t, 2) * cp2Y + 
                          Math.pow(t, 3) * endY;
                return { x, y };
            };

            const phases = Object.entries(maturityPhases);
            phases.forEach(([phaseKey, phase], idx) => {
                const phaseStartProgress = idx / phases.length;
                const phaseEndProgress = (idx + 1) / phases.length;
                
                const zoneStartX = startX + (endX - startX) * phaseStartProgress;
                const zoneEndX = startX + (endX - startX) * phaseEndProgress;
                const zoneWidth = zoneEndX - zoneStartX;
                
                const zoneGradient = ctx.createLinearGradient(0, endY, 0, startY);
                zoneGradient.addColorStop(0, phase.color + '20');
                zoneGradient.addColorStop(1, phase.color + '05');
                
                ctx.fillStyle = zoneGradient;
                ctx.fillRect(zoneStartX, endY - 100, zoneWidth, startY - endY + 200);
                
                const centerX = (zoneStartX + zoneEndX) / 2;
                
                ctx.save();
                ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
                ctx.shadowBlur = 10;
                
                ctx.fillStyle = phase.color + '30';
                ctx.fillRect(centerX - 80, endY - 65, 160, 40);
                ctx.strokeStyle = phase.color;
                ctx.lineWidth = 3;
                ctx.strokeRect(centerX - 80, endY - 65, 160, 40);
                ctx.restore();
                
                ctx.fillStyle = phase.color;
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(phase.name.split(' - ')[0], centerX, endY - 50);
                
                ctx.font = '12px Arial';
                ctx.fillStyle = '#64748b';
                ctx.fillText(`Nivel ${phase.level}`, centerX, endY - 35);
            });

            ctx.save();
            ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
            ctx.shadowBlur = 15;
            
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.bezierCurveTo(cp1X, cp1Y, cp2X, cp2Y, endX, endY);
            ctx.strokeStyle = '#cbd5e1';
            ctx.lineWidth = 12;
            ctx.lineCap = 'round';
            ctx.stroke();
            ctx.restore();

            const currentLevel = calculateMaturityLevel();
            const currentProgress = Math.min((currentLevel - 1) / 4, 1);
            const currentPoint = getPointOnCurve(currentProgress);

            if (currentProgress > 0) {
                ctx.save();
                ctx.shadowColor = 'rgba(16, 185, 129, 0.4)';
                ctx.shadowBlur = 20;

                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.bezierCurveTo(
                    startX + (cp1X - startX) * currentProgress,
                    startY + (cp1Y - startY) * currentProgress,
                    startX + (cp2X - startX) * currentProgress,
                    startY + (cp2Y - startY) * currentProgress,
                    currentPoint.x, currentPoint.y
                );
                ctx.strokeStyle = '#10b981';
                ctx.lineWidth = 15;
                ctx.lineCap = 'round';
                ctx.stroke();
                ctx.restore();
            }

            const allTechnologies = Object.entries(technologies).map(([name, tech]) => ({
                name, 
                ...tech,
                isImplemented: results.implemented.some(impl => impl.name === name)
            }));

            const techsByPhase = { phase1: [], phase2: [], phase3: [], phase4: [] };
            allTechnologies.forEach(tech => {
                if (techsByPhase[tech.phase]) {
                    techsByPhase[tech.phase].push(tech);
                }
            });

            let globalTechIndex = 0;

            Object.entries(techsByPhase).forEach(([phaseKey, techs], phaseIndex) => {
                if (techs.length === 0) return;

                techs.forEach((tech, techIndex) => {
                    const techProgress = (phaseIndex + 0.15 + (techIndex / techs.length) * 0.7) / 4;
                    const curvePoint = getPointOnCurve(techProgress);
                    
                    const verticalSpacing = 200;
                    const isAbove = techIndex % 2 === 0;
                    const horizontalVariation = (techIndex % 4 - 1.5) * 35;
                    
                    const techX = Math.max(80, Math.min(width - 80, curvePoint.x + horizontalVariation));
                    const techY = Math.max(80, Math.min(height - 80, curvePoint.y + (isAbove ? -verticalSpacing : verticalSpacing)));
                    
                    ctx.save();
                    ctx.globalAlpha = 0.8;
                    ctx.beginPath();
                    ctx.moveTo(curvePoint.x, curvePoint.y);
                    const midX = (curvePoint.x + techX) / 2;
                    const midY = (curvePoint.y + techY) / 2 + (isAbove ? -40 : 40);
                    ctx.quadraticCurveTo(midX, midY, techX, techY);
                    ctx.strokeStyle = tech.isImplemented ? '#10b981' : '#94a3b8';
                    ctx.lineWidth = 4;
                    ctx.setLineDash([12, 6]);
                    ctx.stroke();
                    ctx.setLineDash([]);
                    ctx.restore();

                    const circleRadius = 35;
                    
                    ctx.save();
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                    ctx.shadowBlur = 15;
                    
                    ctx.beginPath();
                    ctx.arc(techX, techY, circleRadius, 0, 2 * Math.PI);
                    
                    const techGradient = ctx.createRadialGradient(
                        techX - 10, techY - 10, 0,
                        techX, techY, circleRadius
                    );
                    
                    if (tech.isImplemented) {
                        techGradient.addColorStop(0, '#ffffff');
                        techGradient.addColorStop(0.7, '#10b981');
                        techGradient.addColorStop(1, '#047857');
                    } else {
                        techGradient.addColorStop(0, '#ffffff');
                        techGradient.addColorStop(0.7, '#6b7280');
                        techGradient.addColorStop(1, '#374151');
                    }
                    
                    ctx.fillStyle = techGradient;
                    ctx.fill();
                    ctx.restore();
                    
                    ctx.beginPath();
                    ctx.arc(techX, techY, circleRadius, 0, 2 * Math.PI);
                    ctx.strokeStyle = tech.isImplemented ? '#10b981' : '#6b7280';
                    ctx.lineWidth = 4;
                    ctx.stroke();
                    
                    ctx.fillStyle = tech.isImplemented ? '#ffffff' : '#f8fafc';
                    ctx.font = 'bold 20px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(tech.icon, techX, techY);
                    
                    const labelY = techY + (isAbove ? circleRadius + 45 : -circleRadius - 45);
                    const techName = tech.name.length > 12 ? tech.name.substring(0, 10) + '..' : tech.name;
                    const textWidth = ctx.measureText(techName).width;
                    const labelWidth = textWidth + 20;
                    const labelHeight = 25;
                    
                    ctx.save();
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
                    ctx.shadowBlur = 8;
                    
                    ctx.fillStyle = tech.isImplemented ? 'rgba(16, 185, 129, 0.9)' : 'rgba(107, 114, 128, 0.9)';
                    ctx.fillRect(techX - labelWidth/2, labelY - labelHeight/2, labelWidth, labelHeight);
                    ctx.restore();
                    
                    ctx.strokeStyle = tech.isImplemented ? '#10b981' : '#6b7280';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(techX - labelWidth/2, labelY - labelHeight/2, labelWidth, labelHeight);
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 12px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(techName, techX, labelY);
                    
                    globalTechIndex++;
                });
            });

            if (currentProgress > 0) {
                ctx.save();
                ctx.shadowColor = 'rgba(220, 38, 38, 0.6)';
                ctx.shadowBlur = 25;
                
                ctx.beginPath();
                ctx.arc(currentPoint.x, currentPoint.y, 30, 0, 2 * Math.PI);
                ctx.fillStyle = '#dc2626';
                ctx.fill();
                
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 5;
                ctx.stroke();
                ctx.restore();
                
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('üìç', currentPoint.x, currentPoint.y);
            }

            const targetPoint = getPointOnCurve(1);
            ctx.save();
            ctx.shadowColor = 'rgba(16, 185, 129, 0.6)';
            ctx.shadowBlur = 20;
            
            ctx.beginPath();
            ctx.arc(targetPoint.x, targetPoint.y, 25, 0, 2 * Math.PI);
            ctx.fillStyle = '#10b981';
            ctx.fill();
            
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 4;
            ctx.stroke();
            ctx.restore();
            
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('üéØ', targetPoint.x, targetPoint.y);

            ctx.save();
            ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
            ctx.shadowBlur = 10;
            
            ctx.fillStyle = '#E31E24';
            ctx.font = 'bold 28px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üõ°Ô∏è FORTINET SECURITY ROADMAP', width / 2, 60);
            ctx.restore();

            ctx.fillStyle = '#333333';
            ctx.font = 'bold 18px Arial';
            ctx.fillText(`Journey de Madurez en Ciberseguridad - ${industries[assessmentData.industry]?.name || 'Demo'}`, width / 2, 90);
        }

        // Canvas control functions
        function zoomCanvas(factor) {
            canvasScale *= factor;
            canvasScale = Math.max(0.5, Math.min(3, canvasScale));
            updateCanvasTransform();
        }

        function resetCanvas() {
            canvasScale = 1;
            canvasOffsetX = 0;
            canvasOffsetY = 0;
            updateCanvasTransform();
        }

        function updateCanvasTransform() {
            const canvas = document.getElementById('roadmap-canvas');
            if (canvas) {
                canvas.style.transform = `scale(${canvasScale}) translate(${canvasOffsetX}px, ${canvasOffsetY}px)`;
            }
        }

        function toggleFullscreen() {
            const container = document.getElementById('roadmap-container');
            if (!document.fullscreenElement) {
                container.requestFullscreen().catch(err => {
                    console.log('Error al entrar en pantalla completa:', err);
                });
            } else {
                document.exitFullscreen();
            }
        }

        function setupCanvasControls() {
            const canvas = document.getElementById('roadmap-canvas');
            if (!canvas) return;

            canvas.addEventListener('mousedown', (e) => {
                isDragging = true;
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
                canvas.style.cursor = 'grabbing';
            });

            canvas.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                
                const deltaX = e.clientX - lastMouseX;
                const deltaY = e.clientY - lastMouseY;
                
                canvasOffsetX += deltaX / canvasScale;
                canvasOffsetY += deltaY / canvasScale;
                
                updateCanvasTransform();
                
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
            });

            canvas.addEventListener('mouseup', () => {
                isDragging = false;
                canvas.style.cursor = 'grab';
            });

            canvas.addEventListener('mouseleave', () => {
                isDragging = false;
                canvas.style.cursor = 'grab';
            });

            canvas.addEventListener('wheel', (e) => {
                e.preventDefault();
                const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
                zoomCanvas(zoomFactor);
            });
        }

        // Export and utility functions
        function exportRoadmap() {
            const canvas = document.getElementById('roadmap-canvas');
            if (!canvas) {
                alert('‚ùå Error: No se encontr√≥ el roadmap para exportar');
                return;
            }

            try {
                const dataURL = canvas.toDataURL('image/png', 1.0);
                const tempLink = document.createElement('a');
                tempLink.href = dataURL;
                tempLink.download = `Fortinet-Roadmap-${assessmentData.industry || 'assessment'}-${new Date().toISOString().split('T')[0]}.png`;
                
                document.body.appendChild(tempLink);
                tempLink.click();
                document.body.removeChild(tempLink);
                
                alert('üñºÔ∏è ¬°Roadmap exportado exitosamente!\n\nArchivo: ' + tempLink.download);
            } catch (error) {
                alert('‚ùå Error al exportar roadmap. Por favor intenta de nuevo.');
            }
        }

        function generateReport() {
            if (!results) {
                alert('‚ùå Error: No hay datos para exportar');
                return;
            }

            try {
                const reportText = `FORTINET SECURITY ROADMAP REPORT
================================

INFORMACI√ìN GENERAL
------------------
Fecha: ${new Date().toLocaleDateString('es-ES')}
Industria: ${industries[assessmentData.industry]?.name || 'Assessment'}
Nivel de Madurez: ${results.overallMaturity}/5.0
Fase Actual: ${maturityPhases[results.currentPhase]?.name || 'B√°sico'}
Frameworks: ${assessmentData.frameworks.join(', ')}

M√âTRICAS CLAVE
--------------
Tecnolog√≠as Implementadas: ${results.implemented.length}/${Object.keys(technologies).length}
Completitud: ${Math.round((results.implemented.length / Object.keys(technologies).length) * 100)}%
Reducci√≥n de Riesgo: ${Math.round(results.riskReduction)}%

TECNOLOG√çAS IMPLEMENTADAS
------------------------
${results.implemented.map(t => `‚Ä¢ ${t.icon} ${t.name} - ${t.desc}`).join('\n')}

PR√ìXIMOS PASOS RECOMENDADOS (Prioridad)
---------------------------------------
${results.missing.slice(0, 10).map((t, i) => `${i+1}. ${t.icon} ${t.name} - ${t.desc} (Impacto: +${t.score})`).join('\n')}

CONTACTO
--------
Para implementar estas recomendaciones, contacte a su representante Fortinet.
Generado por: Fortinet Security Fabric Assessment Tool`;
                
                const blob = new Blob([reportText], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const tempLink = document.createElement('a');
                tempLink.href = url;
                tempLink.download = `Fortinet-Report-${assessmentData.industry || 'assessment'}-${new Date().toISOString().split('T')[0]}.txt`;
                
                document.body.appendChild(tempLink);
                tempLink.click();
                document.body.removeChild(tempLink);
                
                setTimeout(() => URL.revokeObjectURL(url), 100);
                
                alert('üìÑ ¬°Reporte generado exitosamente!');
            } catch (error) {
                alert('‚ùå Error al generar reporte. Por favor intenta de nuevo.');
            }
        }

        function shareResults() {
            const url = window.location.href;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(url).then(() => {
                    alert('üîó ¬°URL copiada al portapapeles!');
                }).catch(() => {
                    alert('üîó URL para compartir: ' + url);
                });
            } else {
                alert('üîó URL para compartir: ' + url);
            }
        }

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            const startBtn = document.getElementById('start-btn');
            if (startBtn) {
                startBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    startAssessment();
                });
            }
            
            const continueBtn = document.getElementById('continue-btn');
            if (continueBtn) {
                continueBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    continueToAssessment();
                });
            }
            
            const backBtn = document.getElementById('back-btn');
            if (backBtn) {
                backBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    goToStep(1);
                });
            }
            
            const generateBtn = document.getElementById('generate-btn');
            if (generateBtn) {
                generateBtn.replaceWith(generateBtn.cloneNode(true));
                const newGenerateBtn = document.getElementById('generate-btn');
                
                newGenerateBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    generateResults();
                });
                
                newGenerateBtn.disabled = false;
                newGenerateBtn.style.pointerEvents = 'auto';
                newGenerateBtn.style.opacity = '1';
            }
            
            const resetBtn = document.getElementById('reset-btn');
            if (resetBtn) {
                resetBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    resetAssessment();
                });
            }
            
            const exportBtn = document.getElementById('export-btn');
            if (exportBtn) {
                exportBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    exportRoadmap();
                });
            }
            
            const reportBtn = document.getElementById('report-btn');
            if (reportBtn) {
                reportBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    generateReport();
                });
            }
            
            const shareBtn = document.getElementById('share-btn');
            if (shareBtn) {
                shareBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    shareResults();
                });
            }
        });
    </script>
</body>
</html>
